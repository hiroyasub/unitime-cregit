begin_unit|revision:1.0.0;language:Java;cregit-version:0.0.1
begin_comment
comment|/*  * Licensed to The Apereo Foundation under one or more contributor license  * agreements. See the NOTICE file distributed with this work for  * additional information regarding copyright ownership.  *  * The Apereo Foundation licenses this file to you under the Apache License,  * Version 2.0 (the "License"); you may not use this file except in  * compliance with the License. You may obtain a copy of the License at:  *  * http://www.apache.org/licenses/LICENSE-2.0  *  * Unless required by applicable law or agreed to in writing, software  * distributed under the License is distributed on an "AS IS" BASIS,  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  *  * See the License for the specific language governing permissions and  * limitations under the License.  *  */
end_comment

begin_package
package|package
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|events
package|;
end_package

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Calendar
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Date
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|HashMap
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Map
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Set
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|TreeSet
import|;
end_import

begin_import
import|import
name|org
operator|.
name|hibernate
operator|.
name|Query
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|defaults
operator|.
name|ApplicationProperty
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|defaults
operator|.
name|UserProperty
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|gwt
operator|.
name|command
operator|.
name|server
operator|.
name|GwtRpcImplements
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|gwt
operator|.
name|shared
operator|.
name|EventInterface
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|gwt
operator|.
name|shared
operator|.
name|EventInterface
operator|.
name|ApprovalStatus
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|gwt
operator|.
name|shared
operator|.
name|EventInterface
operator|.
name|ContactInterface
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|gwt
operator|.
name|shared
operator|.
name|EventInterface
operator|.
name|EventType
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|gwt
operator|.
name|shared
operator|.
name|EventInterface
operator|.
name|MeetingConflictInterface
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|gwt
operator|.
name|shared
operator|.
name|EventInterface
operator|.
name|MeetingInterface
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|gwt
operator|.
name|shared
operator|.
name|EventInterface
operator|.
name|EventRoomAvailabilityRpcRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|gwt
operator|.
name|shared
operator|.
name|EventInterface
operator|.
name|EventRoomAvailabilityRpcResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|gwt
operator|.
name|shared
operator|.
name|EventInterface
operator|.
name|ResourceInterface
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|gwt
operator|.
name|shared
operator|.
name|EventInterface
operator|.
name|ResourceType
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|gwt
operator|.
name|shared
operator|.
name|EventInterface
operator|.
name|SponsoringOrganizationInterface
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|ClassEvent
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|ClassInstructor
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|Class_
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|CourseEvent
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|DepartmentalInstructor
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|Event
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|EventContact
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|ExamEvent
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|Location
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|Meeting
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|RelatedCourseInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|Session
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|TeachingResponsibility
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|dao
operator|.
name|ClassEventDAO
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|dao
operator|.
name|CourseEventDAO
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|dao
operator|.
name|EventDAO
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|dao
operator|.
name|ExamEventDAO
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|dao
operator|.
name|LocationDAO
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|dao
operator|.
name|SessionDAO
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|security
operator|.
name|rights
operator|.
name|Right
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|util
operator|.
name|CalendarUtils
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|util
operator|.
name|Constants
import|;
end_import

begin_comment
comment|/**  * @author Tomas Muller  */
end_comment

begin_class
annotation|@
name|GwtRpcImplements
argument_list|(
name|EventRoomAvailabilityRpcRequest
operator|.
name|class
argument_list|)
specifier|public
class|class
name|EventRoomAvailabilityBackend
extends|extends
name|EventAction
argument_list|<
name|EventRoomAvailabilityRpcRequest
argument_list|,
name|EventRoomAvailabilityRpcResponse
argument_list|>
block|{
annotation|@
name|Override
specifier|public
name|EventRoomAvailabilityRpcResponse
name|execute
parameter_list|(
name|EventRoomAvailabilityRpcRequest
name|request
parameter_list|,
name|EventContext
name|context
parameter_list|)
block|{
name|EventRoomAvailabilityRpcResponse
name|response
init|=
operator|new
name|EventRoomAvailabilityRpcResponse
argument_list|()
decl_stmt|;
name|Session
name|session
init|=
name|SessionDAO
operator|.
name|getInstance
argument_list|()
operator|.
name|get
argument_list|(
name|request
operator|.
name|getSessionId
argument_list|()
argument_list|)
decl_stmt|;
name|String
name|nameFormat
init|=
name|context
operator|.
name|getUser
argument_list|()
operator|.
name|getProperty
argument_list|(
name|UserProperty
operator|.
name|NameFormat
argument_list|)
decl_stmt|;
if|if
condition|(
name|request
operator|.
name|hasDates
argument_list|()
operator|&&
name|request
operator|.
name|hasLocations
argument_list|()
condition|)
block|{
for|for
control|(
name|int
name|idx
init|=
literal|0
init|;
name|idx
operator|<
name|request
operator|.
name|getLocations
argument_list|()
operator|.
name|size
argument_list|()
condition|;
name|idx
operator|+=
literal|1000
control|)
block|{
name|String
name|dates
init|=
literal|""
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|request
operator|.
name|getDates
argument_list|()
operator|.
name|size
argument_list|()
condition|;
name|i
operator|++
control|)
name|dates
operator|+=
operator|(
name|dates
operator|.
name|isEmpty
argument_list|()
condition|?
literal|""
else|:
literal|","
operator|)
operator|+
literal|":d"
operator|+
name|i
expr_stmt|;
name|String
name|locations
init|=
literal|""
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|+
name|idx
operator|<
name|request
operator|.
name|getLocations
argument_list|()
operator|.
name|size
argument_list|()
operator|&&
name|i
operator|<
literal|1000
condition|;
name|i
operator|++
control|)
name|locations
operator|+=
operator|(
name|locations
operator|.
name|isEmpty
argument_list|()
condition|?
literal|""
else|:
literal|","
operator|)
operator|+
literal|":l"
operator|+
name|i
expr_stmt|;
name|Query
name|query
init|=
name|EventDAO
operator|.
name|getInstance
argument_list|()
operator|.
name|getSession
argument_list|()
operator|.
name|createQuery
argument_list|(
literal|"select m, l.permanentId from Meeting m, Location x, Location l "
operator|+
literal|"where m.startPeriod<:stopTime and m.stopPeriod>:startTime and m.approvalStatus<= 1 and "
operator|+
literal|"l.session.uniqueId = :sessionId and l.permanentId in ("
operator|+
name|locations
operator|+
literal|") and l.ignoreRoomCheck = false and "
operator|+
literal|"(x.uniqueId = l.uniqueId or x.parentRoom.uniqueId = l.uniqueId or x.uniqueId = l.parentRoom.uniqueId) and "
operator|+
literal|"m.locationPermanentId = x.permanentId and m.meetingDate in ("
operator|+
name|dates
operator|+
literal|")"
argument_list|)
decl_stmt|;
name|query
operator|.
name|setInteger
argument_list|(
literal|"startTime"
argument_list|,
name|request
operator|.
name|getStartSlot
argument_list|()
argument_list|)
expr_stmt|;
name|query
operator|.
name|setInteger
argument_list|(
literal|"stopTime"
argument_list|,
name|request
operator|.
name|getEndSlot
argument_list|()
argument_list|)
expr_stmt|;
name|query
operator|.
name|setLong
argument_list|(
literal|"sessionId"
argument_list|,
name|request
operator|.
name|getSessionId
argument_list|()
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|request
operator|.
name|getDates
argument_list|()
operator|.
name|size
argument_list|()
condition|;
name|i
operator|++
control|)
block|{
name|Date
name|date
init|=
name|CalendarUtils
operator|.
name|dateOfYear2date
argument_list|(
name|session
operator|.
name|getSessionStartYear
argument_list|()
argument_list|,
name|request
operator|.
name|getDates
argument_list|()
operator|.
name|get
argument_list|(
name|i
argument_list|)
argument_list|)
decl_stmt|;
name|query
operator|.
name|setDate
argument_list|(
literal|"d"
operator|+
name|i
argument_list|,
name|date
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|+
name|idx
operator|<
name|request
operator|.
name|getLocations
argument_list|()
operator|.
name|size
argument_list|()
operator|&&
name|i
operator|<
literal|1000
condition|;
name|i
operator|++
control|)
name|query
operator|.
name|setLong
argument_list|(
literal|"l"
operator|+
name|i
argument_list|,
name|request
operator|.
name|getLocations
argument_list|()
operator|.
name|get
argument_list|(
name|idx
operator|+
name|i
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|Object
index|[]
name|o
range|:
operator|(
name|List
argument_list|<
name|Object
index|[]
argument_list|>
operator|)
name|query
operator|.
name|list
argument_list|()
control|)
block|{
name|Meeting
name|m
init|=
operator|(
name|Meeting
operator|)
name|o
index|[
literal|0
index|]
decl_stmt|;
name|Long
name|permId
init|=
operator|(
name|Long
operator|)
name|o
index|[
literal|1
index|]
decl_stmt|;
name|MeetingConflictInterface
name|conflict
init|=
operator|new
name|MeetingConflictInterface
argument_list|()
decl_stmt|;
if|if
condition|(
name|request
operator|.
name|hasEventId
argument_list|()
operator|&&
name|m
operator|.
name|getEvent
argument_list|()
operator|.
name|getUniqueId
argument_list|()
operator|.
name|equals
argument_list|(
name|request
operator|.
name|getEventId
argument_list|()
argument_list|)
condition|)
continue|continue;
name|conflict
operator|.
name|setEventId
argument_list|(
name|m
operator|.
name|getEvent
argument_list|()
operator|.
name|getUniqueId
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setName
argument_list|(
name|m
operator|.
name|getEvent
argument_list|()
operator|.
name|getEventName
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setType
argument_list|(
name|EventInterface
operator|.
name|EventType
operator|.
name|values
argument_list|()
index|[
name|m
operator|.
name|getEvent
argument_list|()
operator|.
name|getEventType
argument_list|()
index|]
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setLimit
argument_list|(
name|m
operator|.
name|getEvent
argument_list|()
operator|.
name|getMaxCapacity
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|m
operator|.
name|getEvent
argument_list|()
operator|.
name|getSponsoringOrganization
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|SponsoringOrganizationInterface
name|sponsor
init|=
operator|new
name|SponsoringOrganizationInterface
argument_list|()
decl_stmt|;
name|sponsor
operator|.
name|setEmail
argument_list|(
name|m
operator|.
name|getEvent
argument_list|()
operator|.
name|getSponsoringOrganization
argument_list|()
operator|.
name|getEmail
argument_list|()
argument_list|)
expr_stmt|;
name|sponsor
operator|.
name|setName
argument_list|(
name|m
operator|.
name|getEvent
argument_list|()
operator|.
name|getSponsoringOrganization
argument_list|()
operator|.
name|getName
argument_list|()
argument_list|)
expr_stmt|;
name|sponsor
operator|.
name|setUniqueId
argument_list|(
name|m
operator|.
name|getEvent
argument_list|()
operator|.
name|getSponsoringOrganization
argument_list|()
operator|.
name|getUniqueId
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setSponsor
argument_list|(
name|sponsor
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|Event
operator|.
name|sEventTypeClass
operator|==
name|m
operator|.
name|getEvent
argument_list|()
operator|.
name|getEventType
argument_list|()
condition|)
block|{
name|ClassEvent
name|ce
init|=
operator|(
name|m
operator|.
name|getEvent
argument_list|()
operator|instanceof
name|ClassEvent
condition|?
operator|(
name|ClassEvent
operator|)
name|m
operator|.
name|getEvent
argument_list|()
else|:
name|ClassEventDAO
operator|.
name|getInstance
argument_list|()
operator|.
name|get
argument_list|(
name|m
operator|.
name|getEvent
argument_list|()
operator|.
name|getUniqueId
argument_list|()
argument_list|)
operator|)
decl_stmt|;
name|Class_
name|clazz
init|=
name|ce
operator|.
name|getClazz
argument_list|()
decl_stmt|;
name|conflict
operator|.
name|setEnrollment
argument_list|(
name|clazz
operator|.
name|getEnrollment
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|clazz
operator|.
name|getDisplayInstructor
argument_list|()
condition|)
block|{
for|for
control|(
name|ClassInstructor
name|i
range|:
name|clazz
operator|.
name|getClassInstructors
argument_list|()
control|)
block|{
if|if
condition|(
name|i
operator|.
name|getResponsibility
argument_list|()
operator|!=
literal|null
operator|&&
name|i
operator|.
name|getResponsibility
argument_list|()
operator|.
name|hasOption
argument_list|(
name|TeachingResponsibility
operator|.
name|Option
operator|.
name|noevents
argument_list|)
condition|)
continue|continue;
name|ContactInterface
name|instructor
init|=
operator|new
name|ContactInterface
argument_list|()
decl_stmt|;
name|instructor
operator|.
name|setFirstName
argument_list|(
name|i
operator|.
name|getInstructor
argument_list|()
operator|.
name|getFirstName
argument_list|()
argument_list|)
expr_stmt|;
name|instructor
operator|.
name|setMiddleName
argument_list|(
name|i
operator|.
name|getInstructor
argument_list|()
operator|.
name|getMiddleName
argument_list|()
argument_list|)
expr_stmt|;
name|instructor
operator|.
name|setLastName
argument_list|(
name|i
operator|.
name|getInstructor
argument_list|()
operator|.
name|getLastName
argument_list|()
argument_list|)
expr_stmt|;
name|instructor
operator|.
name|setAcademicTitle
argument_list|(
name|i
operator|.
name|getInstructor
argument_list|()
operator|.
name|getAcademicTitle
argument_list|()
argument_list|)
expr_stmt|;
name|instructor
operator|.
name|setEmail
argument_list|(
name|i
operator|.
name|getInstructor
argument_list|()
operator|.
name|getEmail
argument_list|()
argument_list|)
expr_stmt|;
name|instructor
operator|.
name|setFormattedName
argument_list|(
name|i
operator|.
name|getInstructor
argument_list|()
operator|.
name|getName
argument_list|(
name|nameFormat
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|.
name|getResponsibility
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|instructor
operator|.
name|setResponsibility
argument_list|(
name|i
operator|.
name|getResponsibility
argument_list|()
operator|.
name|getLabel
argument_list|()
argument_list|)
expr_stmt|;
name|instructor
operator|.
name|setResponsibilityAbbreviation
argument_list|(
name|i
operator|.
name|getResponsibility
argument_list|()
operator|.
name|getAbbreviation
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|conflict
operator|.
name|addInstructor
argument_list|(
name|instructor
argument_list|)
expr_stmt|;
block|}
block|}
block|}
if|else if
condition|(
name|Event
operator|.
name|sEventTypeFinalExam
operator|==
name|m
operator|.
name|getEvent
argument_list|()
operator|.
name|getEventType
argument_list|()
operator|||
name|Event
operator|.
name|sEventTypeMidtermExam
operator|==
name|m
operator|.
name|getEvent
argument_list|()
operator|.
name|getEventType
argument_list|()
condition|)
block|{
name|ExamEvent
name|xe
init|=
operator|(
name|m
operator|.
name|getEvent
argument_list|()
operator|instanceof
name|ExamEvent
condition|?
operator|(
name|ExamEvent
operator|)
name|m
operator|.
name|getEvent
argument_list|()
else|:
name|ExamEventDAO
operator|.
name|getInstance
argument_list|()
operator|.
name|get
argument_list|(
name|m
operator|.
name|getEvent
argument_list|()
operator|.
name|getUniqueId
argument_list|()
argument_list|)
operator|)
decl_stmt|;
name|conflict
operator|.
name|setEnrollment
argument_list|(
name|xe
operator|.
name|getExam
argument_list|()
operator|.
name|countStudents
argument_list|()
argument_list|)
expr_stmt|;
for|for
control|(
name|DepartmentalInstructor
name|i
range|:
name|xe
operator|.
name|getExam
argument_list|()
operator|.
name|getInstructors
argument_list|()
control|)
block|{
name|ContactInterface
name|instructor
init|=
operator|new
name|ContactInterface
argument_list|()
decl_stmt|;
name|instructor
operator|.
name|setFirstName
argument_list|(
name|i
operator|.
name|getFirstName
argument_list|()
argument_list|)
expr_stmt|;
name|instructor
operator|.
name|setMiddleName
argument_list|(
name|i
operator|.
name|getMiddleName
argument_list|()
argument_list|)
expr_stmt|;
name|instructor
operator|.
name|setLastName
argument_list|(
name|i
operator|.
name|getLastName
argument_list|()
argument_list|)
expr_stmt|;
name|instructor
operator|.
name|setAcademicTitle
argument_list|(
name|i
operator|.
name|getAcademicTitle
argument_list|()
argument_list|)
expr_stmt|;
name|instructor
operator|.
name|setEmail
argument_list|(
name|i
operator|.
name|getEmail
argument_list|()
argument_list|)
expr_stmt|;
name|instructor
operator|.
name|setFormattedName
argument_list|(
name|i
operator|.
name|getName
argument_list|(
name|nameFormat
argument_list|)
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|addInstructor
argument_list|(
name|instructor
argument_list|)
expr_stmt|;
block|}
block|}
if|else if
condition|(
name|Event
operator|.
name|sEventTypeCourse
operator|==
name|m
operator|.
name|getEvent
argument_list|()
operator|.
name|getEventType
argument_list|()
condition|)
block|{
name|CourseEvent
name|ce
init|=
operator|(
name|m
operator|.
name|getEvent
argument_list|()
operator|instanceof
name|CourseEvent
condition|?
operator|(
name|CourseEvent
operator|)
name|m
operator|.
name|getEvent
argument_list|()
else|:
name|CourseEventDAO
operator|.
name|getInstance
argument_list|()
operator|.
name|get
argument_list|(
name|m
operator|.
name|getEvent
argument_list|()
operator|.
name|getUniqueId
argument_list|()
argument_list|)
operator|)
decl_stmt|;
name|int
name|enrl
init|=
literal|0
decl_stmt|;
for|for
control|(
name|RelatedCourseInfo
name|owner
range|:
name|ce
operator|.
name|getRelatedCourses
argument_list|()
control|)
block|{
name|enrl
operator|+=
name|owner
operator|.
name|countStudents
argument_list|()
expr_stmt|;
block|}
name|conflict
operator|.
name|setEnrollment
argument_list|(
name|enrl
argument_list|)
expr_stmt|;
block|}
name|conflict
operator|.
name|setId
argument_list|(
name|m
operator|.
name|getUniqueId
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setMeetingDate
argument_list|(
name|m
operator|.
name|getMeetingDate
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setDayOfYear
argument_list|(
name|CalendarUtils
operator|.
name|date2dayOfYear
argument_list|(
name|session
operator|.
name|getSessionStartYear
argument_list|()
argument_list|,
name|m
operator|.
name|getMeetingDate
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setStartOffset
argument_list|(
name|m
operator|.
name|getStartOffset
argument_list|()
operator|==
literal|null
condition|?
literal|0
else|:
name|m
operator|.
name|getStartOffset
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setEndOffset
argument_list|(
name|m
operator|.
name|getStopOffset
argument_list|()
operator|==
literal|null
condition|?
literal|0
else|:
name|m
operator|.
name|getStopOffset
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setStartSlot
argument_list|(
name|m
operator|.
name|getStartPeriod
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setEndSlot
argument_list|(
name|m
operator|.
name|getStopPeriod
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setApprovalDate
argument_list|(
name|m
operator|.
name|getApprovalDate
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setApprovalStatus
argument_list|(
name|m
operator|.
name|getApprovalStatus
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|context
operator|.
name|hasPermission
argument_list|(
name|Right
operator|.
name|EventCanViewMeetingContacts
argument_list|)
condition|)
block|{
name|Map
argument_list|<
name|Long
argument_list|,
name|ContactInterface
argument_list|>
name|contacts
init|=
operator|new
name|HashMap
argument_list|<
name|Long
argument_list|,
name|ContactInterface
argument_list|>
argument_list|()
decl_stmt|;
for|for
control|(
name|EventContact
name|c
range|:
name|m
operator|.
name|getMeetingContacts
argument_list|()
control|)
block|{
name|ContactInterface
name|contact
init|=
name|contacts
operator|.
name|get
argument_list|(
name|c
operator|.
name|getUniqueId
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
name|contact
operator|==
literal|null
condition|)
block|{
name|contact
operator|=
operator|new
name|ContactInterface
argument_list|()
expr_stmt|;
name|contact
operator|.
name|setFirstName
argument_list|(
name|c
operator|.
name|getFirstName
argument_list|()
argument_list|)
expr_stmt|;
name|contact
operator|.
name|setMiddleName
argument_list|(
name|c
operator|.
name|getMiddleName
argument_list|()
argument_list|)
expr_stmt|;
name|contact
operator|.
name|setLastName
argument_list|(
name|c
operator|.
name|getLastName
argument_list|()
argument_list|)
expr_stmt|;
name|contact
operator|.
name|setAcademicTitle
argument_list|(
name|c
operator|.
name|getAcademicTitle
argument_list|()
argument_list|)
expr_stmt|;
name|contact
operator|.
name|setExternalId
argument_list|(
name|c
operator|.
name|getExternalUniqueId
argument_list|()
argument_list|)
expr_stmt|;
name|contact
operator|.
name|setPhone
argument_list|(
name|c
operator|.
name|getPhone
argument_list|()
argument_list|)
expr_stmt|;
name|contact
operator|.
name|setEmail
argument_list|(
name|c
operator|.
name|getEmailAddress
argument_list|()
argument_list|)
expr_stmt|;
name|contact
operator|.
name|setFormattedName
argument_list|(
name|c
operator|.
name|getName
argument_list|(
name|nameFormat
argument_list|)
argument_list|)
expr_stmt|;
name|contacts
operator|.
name|put
argument_list|(
name|c
operator|.
name|getUniqueId
argument_list|()
argument_list|,
name|contact
argument_list|)
expr_stmt|;
block|}
name|conflict
operator|.
name|addMeetingContact
argument_list|(
name|contact
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|m
operator|.
name|getLocation
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|ResourceInterface
name|location
init|=
operator|new
name|ResourceInterface
argument_list|()
decl_stmt|;
name|location
operator|.
name|setType
argument_list|(
name|ResourceType
operator|.
name|ROOM
argument_list|)
expr_stmt|;
name|location
operator|.
name|setId
argument_list|(
name|m
operator|.
name|getLocation
argument_list|()
operator|.
name|getUniqueId
argument_list|()
argument_list|)
expr_stmt|;
name|location
operator|.
name|setName
argument_list|(
name|m
operator|.
name|getLocation
argument_list|()
operator|.
name|getLabel
argument_list|()
argument_list|)
expr_stmt|;
name|location
operator|.
name|setSize
argument_list|(
name|m
operator|.
name|getLocation
argument_list|()
operator|.
name|getCapacity
argument_list|()
argument_list|)
expr_stmt|;
name|location
operator|.
name|setRoomType
argument_list|(
name|m
operator|.
name|getLocation
argument_list|()
operator|.
name|getRoomTypeLabel
argument_list|()
argument_list|)
expr_stmt|;
name|location
operator|.
name|setBreakTime
argument_list|(
name|m
operator|.
name|getLocation
argument_list|()
operator|.
name|getEffectiveBreakTime
argument_list|()
argument_list|)
expr_stmt|;
name|location
operator|.
name|setMessage
argument_list|(
name|m
operator|.
name|getLocation
argument_list|()
operator|.
name|getEventMessage
argument_list|()
argument_list|)
expr_stmt|;
name|location
operator|.
name|setIgnoreRoomCheck
argument_list|(
name|m
operator|.
name|getLocation
argument_list|()
operator|.
name|isIgnoreRoomCheck
argument_list|()
argument_list|)
expr_stmt|;
name|location
operator|.
name|setDisplayName
argument_list|(
name|m
operator|.
name|getLocation
argument_list|()
operator|.
name|getDisplayName
argument_list|()
argument_list|)
expr_stmt|;
name|location
operator|.
name|setPartitionParentId
argument_list|(
name|m
operator|.
name|getLocation
argument_list|()
operator|.
name|getPartitionParentId
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setLocation
argument_list|(
name|location
argument_list|)
expr_stmt|;
block|}
name|response
operator|.
name|addOverlap
argument_list|(
name|CalendarUtils
operator|.
name|date2dayOfYear
argument_list|(
name|session
operator|.
name|getSessionStartYear
argument_list|()
argument_list|,
name|m
operator|.
name|getMeetingDate
argument_list|()
argument_list|)
argument_list|,
name|permId
argument_list|,
name|conflict
argument_list|)
expr_stmt|;
block|}
name|query
operator|=
name|EventDAO
operator|.
name|getInstance
argument_list|()
operator|.
name|getSession
argument_list|()
operator|.
name|createQuery
argument_list|(
literal|"from Location where session.uniqueId = :sessionId and permanentId in ("
operator|+
name|locations
operator|+
literal|")"
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|+
name|idx
operator|<
name|request
operator|.
name|getLocations
argument_list|()
operator|.
name|size
argument_list|()
operator|&&
name|i
operator|<
literal|1000
condition|;
name|i
operator|++
control|)
name|query
operator|.
name|setLong
argument_list|(
literal|"l"
operator|+
name|i
argument_list|,
name|request
operator|.
name|getLocations
argument_list|()
operator|.
name|get
argument_list|(
name|idx
operator|+
name|i
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|Location
name|location
range|:
operator|(
name|List
argument_list|<
name|Location
argument_list|>
operator|)
name|query
operator|.
name|setLong
argument_list|(
literal|"sessionId"
argument_list|,
name|request
operator|.
name|getSessionId
argument_list|()
argument_list|)
operator|.
name|setCacheable
argument_list|(
literal|true
argument_list|)
operator|.
name|list
argument_list|()
control|)
block|{
if|if
condition|(
name|context
operator|.
name|hasPermission
argument_list|(
name|location
argument_list|,
name|request
operator|.
name|getEventType
argument_list|()
operator|==
name|EventType
operator|.
name|Unavailabile
condition|?
name|Right
operator|.
name|EventLocationUnavailable
else|:
name|Right
operator|.
name|EventLocation
argument_list|)
condition|)
block|{
name|Set
argument_list|<
name|MeetingConflictInterface
argument_list|>
name|conflicts
init|=
name|generateUnavailabilityMeetings
argument_list|(
name|location
argument_list|,
name|request
operator|.
name|getDates
argument_list|()
argument_list|,
name|request
operator|.
name|getStartSlot
argument_list|()
argument_list|,
name|request
operator|.
name|getEndSlot
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
name|conflicts
operator|!=
literal|null
operator|&&
operator|!
name|conflicts
operator|.
name|isEmpty
argument_list|()
condition|)
for|for
control|(
name|MeetingConflictInterface
name|conflict
range|:
name|conflicts
control|)
name|response
operator|.
name|addOverlap
argument_list|(
name|conflict
operator|.
name|getDayOfYear
argument_list|()
argument_list|,
name|location
operator|.
name|getPermanentId
argument_list|()
argument_list|,
name|conflict
argument_list|)
expr_stmt|;
block|}
else|else
block|{
for|for
control|(
name|Integer
name|date
range|:
name|request
operator|.
name|getDates
argument_list|()
control|)
block|{
name|MeetingConflictInterface
name|conflict
init|=
operator|new
name|MeetingConflictInterface
argument_list|()
decl_stmt|;
if|if
condition|(
name|location
operator|==
literal|null
operator|||
name|location
operator|.
name|getEventDepartment
argument_list|()
operator|==
literal|null
operator|||
operator|!
name|location
operator|.
name|getEventDepartment
argument_list|()
operator|.
name|isAllowEvents
argument_list|()
condition|)
name|conflict
operator|.
name|setName
argument_list|(
name|MESSAGES
operator|.
name|conflictNotEventRoom
argument_list|(
name|location
operator|.
name|getLabel
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
if|else if
condition|(
name|request
operator|.
name|getEventType
argument_list|()
operator|==
name|EventType
operator|.
name|Unavailabile
condition|)
name|conflict
operator|.
name|setName
argument_list|(
name|MESSAGES
operator|.
name|conflictCannotMakeUnavailable
argument_list|(
name|location
operator|.
name|getLabel
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|conflict
operator|.
name|setName
argument_list|(
name|MESSAGES
operator|.
name|conflictRoomDenied
argument_list|(
name|location
operator|.
name|getLabel
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|location
operator|.
name|getEventDepartment
argument_list|()
operator|!=
literal|null
operator|&&
name|location
operator|.
name|getEventDepartment
argument_list|()
operator|.
name|isAllowEvents
argument_list|()
condition|)
block|{
name|String
name|message
init|=
name|location
operator|.
name|getEventMessage
argument_list|()
decl_stmt|;
if|if
condition|(
name|message
operator|!=
literal|null
operator|&&
operator|!
name|message
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|conflict
operator|.
name|setName
argument_list|(
name|message
argument_list|)
expr_stmt|;
block|}
block|}
name|conflict
operator|.
name|setType
argument_list|(
name|EventInterface
operator|.
name|EventType
operator|.
name|Unavailabile
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setMeetingDate
argument_list|(
name|CalendarUtils
operator|.
name|dateOfYear2date
argument_list|(
name|session
operator|.
name|getSessionStartYear
argument_list|()
argument_list|,
name|date
argument_list|)
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setDayOfYear
argument_list|(
name|date
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setStartOffset
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setEndOffset
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setStartSlot
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setEndSlot
argument_list|(
literal|288
argument_list|)
expr_stmt|;
name|response
operator|.
name|addOverlap
argument_list|(
name|date
argument_list|,
name|location
operator|.
name|getPermanentId
argument_list|()
argument_list|,
name|conflict
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
block|}
if|if
condition|(
name|request
operator|.
name|hasMeetings
argument_list|()
condition|)
block|{
name|response
operator|.
name|setMeetings
argument_list|(
name|request
operator|.
name|getMeetings
argument_list|()
argument_list|)
expr_stmt|;
for|for
control|(
name|MeetingInterface
name|meeting
range|:
name|response
operator|.
name|getMeetings
argument_list|()
control|)
block|{
if|if
condition|(
name|meeting
operator|.
name|hasConflicts
argument_list|()
condition|)
name|meeting
operator|.
name|getConflicts
argument_list|()
operator|.
name|clear
argument_list|()
expr_stmt|;
if|if
condition|(
name|meeting
operator|.
name|getMeetingDate
argument_list|()
operator|==
literal|null
condition|)
block|{
name|meeting
operator|.
name|setMeetingDate
argument_list|(
name|CalendarUtils
operator|.
name|dateOfYear2date
argument_list|(
name|session
operator|.
name|getSessionStartYear
argument_list|()
argument_list|,
name|meeting
operator|.
name|getDayOfYear
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|meeting
operator|.
name|setDayOfWeek
argument_list|(
name|Constants
operator|.
name|getDayOfWeek
argument_list|(
name|meeting
operator|.
name|getMeetingDate
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|meeting
operator|.
name|getApprovalStatus
argument_list|()
operator|==
name|ApprovalStatus
operator|.
name|Deleted
operator|||
name|meeting
operator|.
name|getApprovalStatus
argument_list|()
operator|==
name|ApprovalStatus
operator|.
name|Cancelled
operator|||
name|meeting
operator|.
name|getApprovalStatus
argument_list|()
operator|==
name|ApprovalStatus
operator|.
name|Rejected
condition|)
continue|continue;
if|if
condition|(
name|context
operator|.
name|isPastOrOutside
argument_list|(
name|meeting
operator|.
name|getMeetingDate
argument_list|()
argument_list|)
condition|)
block|{
name|MeetingConflictInterface
name|conflict
init|=
operator|new
name|MeetingConflictInterface
argument_list|()
decl_stmt|;
name|conflict
operator|.
name|setName
argument_list|(
name|MESSAGES
operator|.
name|conflictPastOrOutside
argument_list|(
name|session
operator|.
name|getLabel
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setType
argument_list|(
name|meeting
operator|.
name|getId
argument_list|()
operator|==
literal|null
condition|?
name|EventInterface
operator|.
name|EventType
operator|.
name|Unavailabile
else|:
name|EventInterface
operator|.
name|EventType
operator|.
name|Message
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setMeetingDate
argument_list|(
name|meeting
operator|.
name|getMeetingDate
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setDayOfYear
argument_list|(
name|meeting
operator|.
name|getDayOfYear
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setStartOffset
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setEndOffset
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setStartSlot
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setEndSlot
argument_list|(
literal|288
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setPast
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|meeting
operator|.
name|addConflict
argument_list|(
name|conflict
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|meeting
operator|.
name|hasLocation
argument_list|()
condition|)
continue|continue;
name|meeting
operator|.
name|setCanApprove
argument_list|(
name|context
operator|.
name|hasPermission
argument_list|(
name|meeting
operator|.
name|getLocation
argument_list|()
operator|.
name|getId
argument_list|()
argument_list|,
literal|"Location"
argument_list|,
name|Right
operator|.
name|EventLocationApprove
argument_list|)
argument_list|)
expr_stmt|;
name|Location
name|location
init|=
name|LocationDAO
operator|.
name|getInstance
argument_list|()
operator|.
name|get
argument_list|(
name|meeting
operator|.
name|getLocation
argument_list|()
operator|.
name|getId
argument_list|()
argument_list|)
decl_stmt|;
name|boolean
name|available
init|=
literal|true
decl_stmt|;
name|meeting
operator|.
name|setAutomaticallyApproved
argument_list|(
name|location
operator|!=
literal|null
operator|&&
name|location
operator|.
name|getEffectiveEventStatus
argument_list|()
operator|.
name|isAutomaticApproval
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|location
operator|==
literal|null
operator|||
operator|!
name|context
operator|.
name|hasPermission
argument_list|(
name|location
argument_list|,
name|Right
operator|.
name|EventLocation
argument_list|)
condition|)
block|{
name|MeetingConflictInterface
name|conflict
init|=
operator|new
name|MeetingConflictInterface
argument_list|()
decl_stmt|;
if|if
condition|(
name|location
operator|==
literal|null
operator|||
name|location
operator|.
name|getEventDepartment
argument_list|()
operator|==
literal|null
operator|||
operator|!
name|location
operator|.
name|getEventDepartment
argument_list|()
operator|.
name|isAllowEvents
argument_list|()
condition|)
name|conflict
operator|.
name|setName
argument_list|(
name|MESSAGES
operator|.
name|conflictNotEventRoom
argument_list|(
name|meeting
operator|.
name|getLocationName
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|conflict
operator|.
name|setName
argument_list|(
name|MESSAGES
operator|.
name|conflictRoomDenied
argument_list|(
name|meeting
operator|.
name|getLocationName
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|location
operator|!=
literal|null
operator|&&
name|location
operator|.
name|getEventDepartment
argument_list|()
operator|!=
literal|null
operator|&&
name|location
operator|.
name|getEventDepartment
argument_list|()
operator|.
name|isAllowEvents
argument_list|()
condition|)
block|{
name|String
name|message
init|=
name|location
operator|.
name|getEventMessage
argument_list|()
decl_stmt|;
if|if
condition|(
name|message
operator|!=
literal|null
operator|&&
operator|!
name|message
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|conflict
operator|.
name|setName
argument_list|(
name|message
argument_list|)
expr_stmt|;
block|}
block|}
name|conflict
operator|.
name|setType
argument_list|(
name|meeting
operator|.
name|getId
argument_list|()
operator|==
literal|null
condition|?
name|EventInterface
operator|.
name|EventType
operator|.
name|Unavailabile
else|:
name|EventInterface
operator|.
name|EventType
operator|.
name|Message
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setMeetingDate
argument_list|(
name|meeting
operator|.
name|getMeetingDate
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setDayOfYear
argument_list|(
name|meeting
operator|.
name|getDayOfYear
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setStartOffset
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setEndOffset
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setStartSlot
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setEndSlot
argument_list|(
literal|288
argument_list|)
expr_stmt|;
name|meeting
operator|.
name|addConflict
argument_list|(
name|conflict
argument_list|)
expr_stmt|;
name|available
operator|=
literal|false
expr_stmt|;
block|}
if|else if
condition|(
name|request
operator|.
name|getEventType
argument_list|()
operator|==
name|EventType
operator|.
name|Unavailabile
operator|&&
operator|!
name|context
operator|.
name|hasPermission
argument_list|(
name|location
argument_list|,
name|Right
operator|.
name|EventLocationUnavailable
argument_list|)
condition|)
block|{
name|MeetingConflictInterface
name|conflict
init|=
operator|new
name|MeetingConflictInterface
argument_list|()
decl_stmt|;
if|if
condition|(
name|location
operator|==
literal|null
operator|||
name|location
operator|.
name|getEventDepartment
argument_list|()
operator|==
literal|null
operator|||
operator|!
name|location
operator|.
name|getEventDepartment
argument_list|()
operator|.
name|isAllowEvents
argument_list|()
condition|)
name|conflict
operator|.
name|setName
argument_list|(
name|MESSAGES
operator|.
name|conflictNotEventRoom
argument_list|(
name|meeting
operator|.
name|getLocationName
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|conflict
operator|.
name|setName
argument_list|(
name|MESSAGES
operator|.
name|conflictCannotMakeUnavailable
argument_list|(
name|meeting
operator|.
name|getLocationName
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setType
argument_list|(
name|meeting
operator|.
name|getId
argument_list|()
operator|==
literal|null
condition|?
name|EventInterface
operator|.
name|EventType
operator|.
name|Unavailabile
else|:
name|EventInterface
operator|.
name|EventType
operator|.
name|Message
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setMeetingDate
argument_list|(
name|meeting
operator|.
name|getMeetingDate
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setDayOfYear
argument_list|(
name|meeting
operator|.
name|getDayOfYear
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setStartOffset
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setEndOffset
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setStartSlot
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setEndSlot
argument_list|(
literal|288
argument_list|)
expr_stmt|;
name|meeting
operator|.
name|addConflict
argument_list|(
name|conflict
argument_list|)
expr_stmt|;
name|available
operator|=
literal|false
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|location
operator|.
name|isIgnoreRoomCheck
argument_list|()
condition|)
for|for
control|(
name|Meeting
name|m
range|:
operator|(
name|List
argument_list|<
name|Meeting
argument_list|>
operator|)
name|EventDAO
operator|.
name|getInstance
argument_list|()
operator|.
name|getSession
argument_list|()
operator|.
name|createQuery
argument_list|(
literal|"select m from Meeting m, Location x, Location l "
operator|+
literal|"where m.startPeriod< :stopTime and m.stopPeriod> :startTime and m.approvalStatus<= 1 and "
operator|+
literal|"m.locationPermanentId = x.permanentId and l.uniqueId = :locationdId and m.meetingDate = :meetingDate and m.uniqueId != :meetingId and "
operator|+
literal|"(x.uniqueId = l.uniqueId or x.parentRoom.uniqueId = l.uniqueId or x.uniqueId = l.parentRoom.uniqueId) and l.ignoreRoomCheck = false"
argument_list|)
operator|.
name|setInteger
argument_list|(
literal|"startTime"
argument_list|,
name|meeting
operator|.
name|getStartSlot
argument_list|()
argument_list|)
operator|.
name|setInteger
argument_list|(
literal|"stopTime"
argument_list|,
name|meeting
operator|.
name|getEndSlot
argument_list|()
argument_list|)
operator|.
name|setDate
argument_list|(
literal|"meetingDate"
argument_list|,
name|meeting
operator|.
name|getMeetingDate
argument_list|()
argument_list|)
operator|.
name|setLong
argument_list|(
literal|"locationdId"
argument_list|,
name|meeting
operator|.
name|getLocation
argument_list|()
operator|.
name|getId
argument_list|()
argument_list|)
operator|.
name|setLong
argument_list|(
literal|"meetingId"
argument_list|,
name|meeting
operator|.
name|getId
argument_list|()
operator|==
literal|null
condition|?
operator|-
literal|1
else|:
name|meeting
operator|.
name|getId
argument_list|()
argument_list|)
operator|.
name|list
argument_list|()
control|)
block|{
name|MeetingConflictInterface
name|conflict
init|=
operator|new
name|MeetingConflictInterface
argument_list|()
decl_stmt|;
if|if
condition|(
name|request
operator|.
name|hasEventId
argument_list|()
operator|&&
name|m
operator|.
name|getEvent
argument_list|()
operator|.
name|getUniqueId
argument_list|()
operator|.
name|equals
argument_list|(
name|request
operator|.
name|getEventId
argument_list|()
argument_list|)
condition|)
continue|continue;
name|conflict
operator|.
name|setEventId
argument_list|(
name|m
operator|.
name|getEvent
argument_list|()
operator|.
name|getUniqueId
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setName
argument_list|(
name|m
operator|.
name|getEvent
argument_list|()
operator|.
name|getEventName
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setType
argument_list|(
name|EventInterface
operator|.
name|EventType
operator|.
name|values
argument_list|()
index|[
name|m
operator|.
name|getEvent
argument_list|()
operator|.
name|getEventType
argument_list|()
index|]
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setId
argument_list|(
name|m
operator|.
name|getUniqueId
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setMeetingDate
argument_list|(
name|m
operator|.
name|getMeetingDate
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setDayOfYear
argument_list|(
name|meeting
operator|.
name|getDayOfYear
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setStartSlot
argument_list|(
name|m
operator|.
name|getStartPeriod
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setEndSlot
argument_list|(
name|m
operator|.
name|getStopPeriod
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setStartOffset
argument_list|(
name|m
operator|.
name|getStartOffset
argument_list|()
operator|==
literal|null
condition|?
literal|0
else|:
name|m
operator|.
name|getStartOffset
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setEndOffset
argument_list|(
name|m
operator|.
name|getStopOffset
argument_list|()
operator|==
literal|null
condition|?
literal|0
else|:
name|m
operator|.
name|getStopOffset
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setApprovalDate
argument_list|(
name|m
operator|.
name|getApprovalDate
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setApprovalStatus
argument_list|(
name|m
operator|.
name|getApprovalStatus
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|context
operator|.
name|hasPermission
argument_list|(
name|Right
operator|.
name|EventCanViewMeetingContacts
argument_list|)
condition|)
block|{
name|Map
argument_list|<
name|Long
argument_list|,
name|ContactInterface
argument_list|>
name|contacts
init|=
operator|new
name|HashMap
argument_list|<
name|Long
argument_list|,
name|ContactInterface
argument_list|>
argument_list|()
decl_stmt|;
for|for
control|(
name|EventContact
name|c
range|:
name|m
operator|.
name|getMeetingContacts
argument_list|()
control|)
block|{
name|ContactInterface
name|contact
init|=
name|contacts
operator|.
name|get
argument_list|(
name|c
operator|.
name|getUniqueId
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
name|contact
operator|==
literal|null
condition|)
block|{
name|contact
operator|=
operator|new
name|ContactInterface
argument_list|()
expr_stmt|;
name|contact
operator|.
name|setFirstName
argument_list|(
name|c
operator|.
name|getFirstName
argument_list|()
argument_list|)
expr_stmt|;
name|contact
operator|.
name|setMiddleName
argument_list|(
name|c
operator|.
name|getMiddleName
argument_list|()
argument_list|)
expr_stmt|;
name|contact
operator|.
name|setLastName
argument_list|(
name|c
operator|.
name|getLastName
argument_list|()
argument_list|)
expr_stmt|;
name|contact
operator|.
name|setAcademicTitle
argument_list|(
name|c
operator|.
name|getAcademicTitle
argument_list|()
argument_list|)
expr_stmt|;
name|contact
operator|.
name|setExternalId
argument_list|(
name|c
operator|.
name|getExternalUniqueId
argument_list|()
argument_list|)
expr_stmt|;
name|contact
operator|.
name|setPhone
argument_list|(
name|c
operator|.
name|getPhone
argument_list|()
argument_list|)
expr_stmt|;
name|contact
operator|.
name|setEmail
argument_list|(
name|c
operator|.
name|getEmailAddress
argument_list|()
argument_list|)
expr_stmt|;
name|contact
operator|.
name|setFormattedName
argument_list|(
name|c
operator|.
name|getName
argument_list|(
name|nameFormat
argument_list|)
argument_list|)
expr_stmt|;
name|contacts
operator|.
name|put
argument_list|(
name|c
operator|.
name|getUniqueId
argument_list|()
argument_list|,
name|contact
argument_list|)
expr_stmt|;
block|}
name|conflict
operator|.
name|addMeetingContact
argument_list|(
name|contact
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|m
operator|.
name|getLocation
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|ResourceInterface
name|loc
init|=
operator|new
name|ResourceInterface
argument_list|()
decl_stmt|;
name|loc
operator|.
name|setType
argument_list|(
name|ResourceType
operator|.
name|ROOM
argument_list|)
expr_stmt|;
name|loc
operator|.
name|setId
argument_list|(
name|m
operator|.
name|getLocation
argument_list|()
operator|.
name|getUniqueId
argument_list|()
argument_list|)
expr_stmt|;
name|loc
operator|.
name|setName
argument_list|(
name|m
operator|.
name|getLocation
argument_list|()
operator|.
name|getLabel
argument_list|()
argument_list|)
expr_stmt|;
name|loc
operator|.
name|setSize
argument_list|(
name|m
operator|.
name|getLocation
argument_list|()
operator|.
name|getCapacity
argument_list|()
argument_list|)
expr_stmt|;
name|loc
operator|.
name|setRoomType
argument_list|(
name|m
operator|.
name|getLocation
argument_list|()
operator|.
name|getRoomTypeLabel
argument_list|()
argument_list|)
expr_stmt|;
name|loc
operator|.
name|setBreakTime
argument_list|(
name|m
operator|.
name|getLocation
argument_list|()
operator|.
name|getEffectiveBreakTime
argument_list|()
argument_list|)
expr_stmt|;
name|loc
operator|.
name|setMessage
argument_list|(
name|m
operator|.
name|getLocation
argument_list|()
operator|.
name|getEventMessage
argument_list|()
argument_list|)
expr_stmt|;
name|loc
operator|.
name|setIgnoreRoomCheck
argument_list|(
name|m
operator|.
name|getLocation
argument_list|()
operator|.
name|isIgnoreRoomCheck
argument_list|()
argument_list|)
expr_stmt|;
name|loc
operator|.
name|setDisplayName
argument_list|(
name|m
operator|.
name|getLocation
argument_list|()
operator|.
name|getDisplayName
argument_list|()
argument_list|)
expr_stmt|;
name|loc
operator|.
name|setPartitionParentId
argument_list|(
name|m
operator|.
name|getLocation
argument_list|()
operator|.
name|getPartitionParentId
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setLocation
argument_list|(
name|loc
argument_list|)
expr_stmt|;
block|}
name|meeting
operator|.
name|addConflict
argument_list|(
name|conflict
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|location
operator|!=
literal|null
operator|&&
name|location
operator|.
name|getEventAvailability
argument_list|()
operator|!=
literal|null
operator|&&
name|location
operator|.
name|getEventAvailability
argument_list|()
operator|.
name|length
argument_list|()
operator|==
name|Constants
operator|.
name|SLOTS_PER_DAY
operator|*
name|Constants
operator|.
name|DAY_CODES
operator|.
name|length
condition|)
block|{
name|check
label|:
for|for
control|(
name|int
name|slot
init|=
name|meeting
operator|.
name|getStartSlot
argument_list|()
init|;
name|slot
operator|<
name|meeting
operator|.
name|getEndSlot
argument_list|()
condition|;
name|slot
operator|++
control|)
block|{
if|if
condition|(
name|location
operator|.
name|getEventAvailability
argument_list|()
operator|.
name|charAt
argument_list|(
name|meeting
operator|.
name|getDayOfWeek
argument_list|()
operator|*
name|Constants
operator|.
name|SLOTS_PER_DAY
operator|+
name|slot
argument_list|)
operator|==
literal|'1'
condition|)
block|{
for|for
control|(
name|MeetingConflictInterface
name|conflict
range|:
name|generateUnavailabilityMeetings
argument_list|(
name|location
argument_list|,
name|meeting
argument_list|)
control|)
name|meeting
operator|.
name|addConflict
argument_list|(
name|conflict
argument_list|)
expr_stmt|;
break|break
name|check
break|;
block|}
block|}
block|}
if|if
condition|(
name|available
condition|)
block|{
if|if
condition|(
name|location
operator|.
name|getEventDepartment
argument_list|()
operator|==
literal|null
operator|||
operator|!
name|location
operator|.
name|getEventDepartment
argument_list|()
operator|.
name|isAllowEvents
argument_list|()
condition|)
block|{
comment|// no event department
name|MeetingConflictInterface
name|conflict
init|=
operator|new
name|MeetingConflictInterface
argument_list|()
decl_stmt|;
name|conflict
operator|.
name|setName
argument_list|(
name|MESSAGES
operator|.
name|conflictNotEventRoom
argument_list|(
name|meeting
operator|.
name|getLocationName
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setType
argument_list|(
name|EventInterface
operator|.
name|EventType
operator|.
name|Message
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setMeetingDate
argument_list|(
name|meeting
operator|.
name|getMeetingDate
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setDayOfYear
argument_list|(
name|meeting
operator|.
name|getDayOfYear
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setStartOffset
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setEndOffset
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setStartSlot
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setEndSlot
argument_list|(
literal|288
argument_list|)
expr_stmt|;
name|meeting
operator|.
name|addConflict
argument_list|(
name|conflict
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|// has a message?
name|String
name|message
init|=
name|location
operator|.
name|getEventMessage
argument_list|()
decl_stmt|;
if|if
condition|(
name|message
operator|!=
literal|null
operator|&&
operator|!
name|message
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|MeetingConflictInterface
name|conflict
init|=
operator|new
name|MeetingConflictInterface
argument_list|()
decl_stmt|;
name|conflict
operator|.
name|setName
argument_list|(
name|message
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setType
argument_list|(
name|EventInterface
operator|.
name|EventType
operator|.
name|Message
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setMeetingDate
argument_list|(
name|meeting
operator|.
name|getMeetingDate
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setDayOfYear
argument_list|(
name|meeting
operator|.
name|getDayOfYear
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setStartOffset
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setEndOffset
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setStartSlot
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setEndSlot
argument_list|(
literal|288
argument_list|)
expr_stmt|;
name|meeting
operator|.
name|addConflict
argument_list|(
name|conflict
argument_list|)
expr_stmt|;
block|}
block|}
name|int
name|tooEarly
init|=
name|ApplicationProperty
operator|.
name|EventTooEarlySlot
operator|.
name|intValue
argument_list|()
decl_stmt|;
if|if
condition|(
name|tooEarly
operator|>=
literal|0
operator|&&
operator|(
operator|(
name|meeting
operator|.
name|getStartSlot
argument_list|()
operator|>
literal|0
operator|&&
name|meeting
operator|.
name|getStartSlot
argument_list|()
operator|<=
name|tooEarly
operator|)
operator|||
operator|(
name|meeting
operator|.
name|getStartSlot
argument_list|()
operator|==
literal|0
operator|&&
name|meeting
operator|.
name|getEndSlot
argument_list|()
operator|<=
name|tooEarly
operator|)
operator|)
condition|)
block|{
name|MeetingConflictInterface
name|conflict
init|=
operator|new
name|MeetingConflictInterface
argument_list|()
decl_stmt|;
name|conflict
operator|.
name|setName
argument_list|(
name|MESSAGES
operator|.
name|warnMeetingTooEarly
argument_list|(
name|meeting
operator|.
name|getAllocatedTime
argument_list|(
name|CONSTANTS
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setType
argument_list|(
name|EventInterface
operator|.
name|EventType
operator|.
name|Message
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setMeetingDate
argument_list|(
name|meeting
operator|.
name|getMeetingDate
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setDayOfYear
argument_list|(
name|meeting
operator|.
name|getDayOfYear
argument_list|()
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setStartOffset
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setEndOffset
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setStartSlot
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|conflict
operator|.
name|setEndSlot
argument_list|(
literal|288
argument_list|)
expr_stmt|;
name|meeting
operator|.
name|addConflict
argument_list|(
name|conflict
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
return|return
name|response
return|;
block|}
specifier|public
specifier|static
name|TreeSet
argument_list|<
name|MeetingConflictInterface
argument_list|>
name|generateUnavailabilityMeetings
parameter_list|(
name|Location
name|location
parameter_list|,
name|List
argument_list|<
name|Integer
argument_list|>
name|dates
parameter_list|,
name|int
name|startSlot
parameter_list|,
name|int
name|endSlot
parameter_list|)
block|{
if|if
condition|(
name|location
operator|.
name|getEventAvailability
argument_list|()
operator|==
literal|null
operator|||
name|location
operator|.
name|getEventAvailability
argument_list|()
operator|.
name|length
argument_list|()
operator|!=
name|Constants
operator|.
name|SLOTS_PER_DAY
operator|*
name|Constants
operator|.
name|DAY_CODES
operator|.
name|length
condition|)
return|return
literal|null
return|;
name|TreeSet
argument_list|<
name|MeetingConflictInterface
argument_list|>
name|ret
init|=
operator|new
name|TreeSet
argument_list|<
name|MeetingConflictInterface
argument_list|>
argument_list|()
decl_stmt|;
name|ResourceInterface
name|resource
init|=
operator|new
name|ResourceInterface
argument_list|()
decl_stmt|;
name|resource
operator|.
name|setType
argument_list|(
name|ResourceType
operator|.
name|ROOM
argument_list|)
expr_stmt|;
name|resource
operator|.
name|setId
argument_list|(
name|location
operator|.
name|getUniqueId
argument_list|()
argument_list|)
expr_stmt|;
name|resource
operator|.
name|setName
argument_list|(
name|location
operator|.
name|getLabel
argument_list|()
argument_list|)
expr_stmt|;
name|resource
operator|.
name|setSize
argument_list|(
name|location
operator|.
name|getCapacity
argument_list|()
argument_list|)
expr_stmt|;
name|resource
operator|.
name|setRoomType
argument_list|(
name|location
operator|.
name|getRoomTypeLabel
argument_list|()
argument_list|)
expr_stmt|;
name|resource
operator|.
name|setBreakTime
argument_list|(
name|location
operator|.
name|getEffectiveBreakTime
argument_list|()
argument_list|)
expr_stmt|;
name|resource
operator|.
name|setMessage
argument_list|(
name|location
operator|.
name|getEventMessage
argument_list|()
argument_list|)
expr_stmt|;
name|resource
operator|.
name|setIgnoreRoomCheck
argument_list|(
name|location
operator|.
name|isIgnoreRoomCheck
argument_list|()
argument_list|)
expr_stmt|;
name|resource
operator|.
name|setDisplayName
argument_list|(
name|location
operator|.
name|getDisplayName
argument_list|()
argument_list|)
expr_stmt|;
name|resource
operator|.
name|setPartitionParentId
argument_list|(
name|location
operator|.
name|getPartitionParentId
argument_list|()
argument_list|)
expr_stmt|;
name|Calendar
name|calendar
init|=
name|Calendar
operator|.
name|getInstance
argument_list|()
decl_stmt|;
for|for
control|(
name|int
name|day
init|=
literal|0
init|;
name|day
operator|<
name|Constants
operator|.
name|DAY_CODES
operator|.
name|length
condition|;
name|day
operator|++
control|)
for|for
control|(
name|int
name|startTime
init|=
literal|0
init|;
name|startTime
operator|<
name|Constants
operator|.
name|SLOTS_PER_DAY
condition|;
control|)
block|{
if|if
condition|(
name|location
operator|.
name|getEventAvailability
argument_list|()
operator|.
name|charAt
argument_list|(
name|day
operator|*
name|Constants
operator|.
name|SLOTS_PER_DAY
operator|+
name|startTime
argument_list|)
operator|!=
literal|'1'
condition|)
block|{
name|startTime
operator|++
expr_stmt|;
continue|continue;
block|}
name|int
name|endTime
init|=
name|startTime
operator|+
literal|1
decl_stmt|;
while|while
condition|(
name|endTime
operator|<
name|Constants
operator|.
name|SLOTS_PER_DAY
operator|&&
name|location
operator|.
name|getEventAvailability
argument_list|()
operator|.
name|charAt
argument_list|(
name|day
operator|*
name|Constants
operator|.
name|SLOTS_PER_DAY
operator|+
name|endTime
argument_list|)
operator|==
literal|'1'
condition|)
name|endTime
operator|++
expr_stmt|;
if|if
condition|(
name|startTime
operator|<
name|endSlot
operator|&&
name|startSlot
operator|<
name|endTime
condition|)
block|{
name|calendar
operator|.
name|setTime
argument_list|(
name|location
operator|.
name|getSession
argument_list|()
operator|.
name|getEventBeginDate
argument_list|()
argument_list|)
expr_stmt|;
name|int
name|dayOfYear
init|=
name|CalendarUtils
operator|.
name|date2dayOfYear
argument_list|(
name|location
operator|.
name|getSession
argument_list|()
operator|.
name|getSessionStartYear
argument_list|()
argument_list|,
name|calendar
operator|.
name|getTime
argument_list|()
argument_list|)
decl_stmt|;
do|do
block|{
if|if
condition|(
name|dates
operator|.
name|contains
argument_list|(
name|dayOfYear
argument_list|)
condition|)
block|{
name|int
name|dayOfWeek
init|=
operator|-
literal|1
decl_stmt|;
switch|switch
condition|(
name|calendar
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|DAY_OF_WEEK
argument_list|)
condition|)
block|{
case|case
name|Calendar
operator|.
name|MONDAY
case|:
name|dayOfWeek
operator|=
name|Constants
operator|.
name|DAY_MON
expr_stmt|;
break|break;
case|case
name|Calendar
operator|.
name|TUESDAY
case|:
name|dayOfWeek
operator|=
name|Constants
operator|.
name|DAY_TUE
expr_stmt|;
break|break;
case|case
name|Calendar
operator|.
name|WEDNESDAY
case|:
name|dayOfWeek
operator|=
name|Constants
operator|.
name|DAY_WED
expr_stmt|;
break|break;
case|case
name|Calendar
operator|.
name|THURSDAY
case|:
name|dayOfWeek
operator|=
name|Constants
operator|.
name|DAY_THU
expr_stmt|;
break|break;
case|case
name|Calendar
operator|.
name|FRIDAY
case|:
name|dayOfWeek
operator|=
name|Constants
operator|.
name|DAY_FRI
expr_stmt|;
break|break;
case|case
name|Calendar
operator|.
name|SATURDAY
case|:
name|dayOfWeek
operator|=
name|Constants
operator|.
name|DAY_SAT
expr_stmt|;
break|break;
case|case
name|Calendar
operator|.
name|SUNDAY
case|:
name|dayOfWeek
operator|=
name|Constants
operator|.
name|DAY_SUN
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|day
operator|==
name|dayOfWeek
condition|)
block|{
name|MeetingConflictInterface
name|m
init|=
operator|new
name|MeetingConflictInterface
argument_list|()
decl_stmt|;
name|m
operator|.
name|setName
argument_list|(
name|MESSAGES
operator|.
name|unavailableEventDefaultName
argument_list|()
argument_list|)
expr_stmt|;
name|m
operator|.
name|setType
argument_list|(
name|EventInterface
operator|.
name|EventType
operator|.
name|Unavailabile
argument_list|)
expr_stmt|;
name|m
operator|.
name|setStartSlot
argument_list|(
name|startTime
argument_list|)
expr_stmt|;
name|m
operator|.
name|setEndSlot
argument_list|(
name|endTime
argument_list|)
expr_stmt|;
name|m
operator|.
name|setDayOfWeek
argument_list|(
name|dayOfWeek
argument_list|)
expr_stmt|;
name|m
operator|.
name|setMeetingDate
argument_list|(
name|calendar
operator|.
name|getTime
argument_list|()
argument_list|)
expr_stmt|;
name|m
operator|.
name|setDayOfYear
argument_list|(
name|dayOfYear
argument_list|)
expr_stmt|;
name|m
operator|.
name|setLocation
argument_list|(
name|resource
argument_list|)
expr_stmt|;
name|ret
operator|.
name|add
argument_list|(
name|m
argument_list|)
expr_stmt|;
block|}
block|}
name|calendar
operator|.
name|add
argument_list|(
name|Calendar
operator|.
name|DAY_OF_YEAR
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|dayOfYear
operator|++
expr_stmt|;
block|}
do|while
condition|(
operator|!
name|calendar
operator|.
name|getTime
argument_list|()
operator|.
name|after
argument_list|(
name|location
operator|.
name|getSession
argument_list|()
operator|.
name|getEventEndDate
argument_list|()
argument_list|)
condition|)
do|;
block|}
name|startTime
operator|=
name|endTime
expr_stmt|;
block|}
return|return
name|ret
return|;
block|}
specifier|public
specifier|static
name|TreeSet
argument_list|<
name|MeetingConflictInterface
argument_list|>
name|generateUnavailabilityMeetings
parameter_list|(
name|Location
name|location
parameter_list|,
name|MeetingInterface
name|meeting
parameter_list|)
block|{
if|if
condition|(
name|location
operator|.
name|getEventAvailability
argument_list|()
operator|==
literal|null
operator|||
name|location
operator|.
name|getEventAvailability
argument_list|()
operator|.
name|length
argument_list|()
operator|!=
name|Constants
operator|.
name|SLOTS_PER_DAY
operator|*
name|Constants
operator|.
name|DAY_CODES
operator|.
name|length
condition|)
return|return
literal|null
return|;
name|TreeSet
argument_list|<
name|MeetingConflictInterface
argument_list|>
name|ret
init|=
operator|new
name|TreeSet
argument_list|<
name|MeetingConflictInterface
argument_list|>
argument_list|()
decl_stmt|;
name|ResourceInterface
name|resource
init|=
operator|new
name|ResourceInterface
argument_list|()
decl_stmt|;
name|resource
operator|.
name|setType
argument_list|(
name|ResourceType
operator|.
name|ROOM
argument_list|)
expr_stmt|;
name|resource
operator|.
name|setId
argument_list|(
name|location
operator|.
name|getUniqueId
argument_list|()
argument_list|)
expr_stmt|;
name|resource
operator|.
name|setName
argument_list|(
name|location
operator|.
name|getLabel
argument_list|()
argument_list|)
expr_stmt|;
name|resource
operator|.
name|setSize
argument_list|(
name|location
operator|.
name|getCapacity
argument_list|()
argument_list|)
expr_stmt|;
name|resource
operator|.
name|setRoomType
argument_list|(
name|location
operator|.
name|getRoomTypeLabel
argument_list|()
argument_list|)
expr_stmt|;
name|resource
operator|.
name|setBreakTime
argument_list|(
name|location
operator|.
name|getEffectiveBreakTime
argument_list|()
argument_list|)
expr_stmt|;
name|resource
operator|.
name|setMessage
argument_list|(
name|location
operator|.
name|getEventMessage
argument_list|()
argument_list|)
expr_stmt|;
name|resource
operator|.
name|setIgnoreRoomCheck
argument_list|(
name|location
operator|.
name|isIgnoreRoomCheck
argument_list|()
argument_list|)
expr_stmt|;
name|resource
operator|.
name|setDisplayName
argument_list|(
name|location
operator|.
name|getDisplayName
argument_list|()
argument_list|)
expr_stmt|;
name|resource
operator|.
name|setPartitionParentId
argument_list|(
name|location
operator|.
name|getPartitionParentId
argument_list|()
argument_list|)
expr_stmt|;
name|int
name|day
init|=
name|meeting
operator|.
name|getDayOfWeek
argument_list|()
decl_stmt|;
for|for
control|(
name|int
name|startTime
init|=
literal|0
init|;
name|startTime
operator|<
name|Constants
operator|.
name|SLOTS_PER_DAY
condition|;
control|)
block|{
if|if
condition|(
name|location
operator|.
name|getEventAvailability
argument_list|()
operator|.
name|charAt
argument_list|(
name|day
operator|*
name|Constants
operator|.
name|SLOTS_PER_DAY
operator|+
name|startTime
argument_list|)
operator|!=
literal|'1'
condition|)
block|{
name|startTime
operator|++
expr_stmt|;
continue|continue;
block|}
name|int
name|endTime
init|=
name|startTime
operator|+
literal|1
decl_stmt|;
while|while
condition|(
name|endTime
operator|<
name|Constants
operator|.
name|SLOTS_PER_DAY
operator|&&
name|location
operator|.
name|getEventAvailability
argument_list|()
operator|.
name|charAt
argument_list|(
name|day
operator|*
name|Constants
operator|.
name|SLOTS_PER_DAY
operator|+
name|endTime
argument_list|)
operator|==
literal|'1'
condition|)
name|endTime
operator|++
expr_stmt|;
if|if
condition|(
name|startTime
operator|<
name|meeting
operator|.
name|getEndSlot
argument_list|()
operator|&&
name|meeting
operator|.
name|getStartSlot
argument_list|()
operator|<
name|endTime
condition|)
block|{
name|MeetingConflictInterface
name|m
init|=
operator|new
name|MeetingConflictInterface
argument_list|()
decl_stmt|;
name|m
operator|.
name|setName
argument_list|(
name|MESSAGES
operator|.
name|unavailableEventDefaultName
argument_list|()
argument_list|)
expr_stmt|;
name|m
operator|.
name|setType
argument_list|(
name|EventInterface
operator|.
name|EventType
operator|.
name|Unavailabile
argument_list|)
expr_stmt|;
name|m
operator|.
name|setStartSlot
argument_list|(
name|startTime
argument_list|)
expr_stmt|;
name|m
operator|.
name|setEndSlot
argument_list|(
name|endTime
argument_list|)
expr_stmt|;
name|m
operator|.
name|setDayOfWeek
argument_list|(
name|meeting
operator|.
name|getDayOfWeek
argument_list|()
argument_list|)
expr_stmt|;
name|m
operator|.
name|setMeetingDate
argument_list|(
name|meeting
operator|.
name|getMeetingDate
argument_list|()
argument_list|)
expr_stmt|;
name|m
operator|.
name|setDayOfYear
argument_list|(
name|meeting
operator|.
name|getDayOfYear
argument_list|()
argument_list|)
expr_stmt|;
name|m
operator|.
name|setLocation
argument_list|(
name|resource
argument_list|)
expr_stmt|;
name|ret
operator|.
name|add
argument_list|(
name|m
argument_list|)
expr_stmt|;
block|}
name|startTime
operator|=
name|endTime
expr_stmt|;
block|}
return|return
name|ret
return|;
block|}
block|}
end_class

end_unit

