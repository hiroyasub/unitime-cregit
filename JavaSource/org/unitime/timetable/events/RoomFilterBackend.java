begin_unit|revision:1.0.0;language:Java;cregit-version:0.0.1
begin_comment
comment|/*  * UniTime 3.4 (University Timetabling Application)  * Copyright (C) 2012, UniTime LLC, and individual contributors  * as indicated by the @authors tag.  *   * This program is free software; you can redistribute it and/or modify  * it under the terms of the GNU General Public License as published by  * the Free Software Foundation; either version 3 of the License, or  * (at your option) any later version.  *   * This program is distributed in the hope that it will be useful,  * but WITHOUT ANY WARRANTY; without even the implied warranty of  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  * GNU General Public License for more details.  *   * You should have received a copy of the GNU General Public License along  * with this program.  If not, see<http://www.gnu.org/licenses/>.  *  */
end_comment

begin_package
package|package
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|events
package|;
end_package

begin_import
import|import
name|java
operator|.
name|text
operator|.
name|DecimalFormat
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|ArrayList
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Collections
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Comparator
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|HashMap
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|HashSet
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Hashtable
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Map
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Set
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|TreeSet
import|;
end_import

begin_import
import|import
name|net
operator|.
name|sf
operator|.
name|cpsolver
operator|.
name|ifs
operator|.
name|util
operator|.
name|DataProperties
import|;
end_import

begin_import
import|import
name|net
operator|.
name|sf
operator|.
name|cpsolver
operator|.
name|ifs
operator|.
name|util
operator|.
name|DistanceMetric
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|ApplicationProperties
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|gwt
operator|.
name|client
operator|.
name|events
operator|.
name|UniTimeFilterBox
operator|.
name|FilterRpcRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|gwt
operator|.
name|client
operator|.
name|events
operator|.
name|UniTimeFilterBox
operator|.
name|FilterRpcResponse
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|gwt
operator|.
name|client
operator|.
name|events
operator|.
name|UniTimeFilterBox
operator|.
name|FilterRpcResponse
operator|.
name|Entity
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|gwt
operator|.
name|server
operator|.
name|Query
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|gwt
operator|.
name|server
operator|.
name|Query
operator|.
name|TermMatcher
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|Building
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|Department
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|DepartmentRoomFeature
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|Exam
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|GlobalRoomFeature
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|Location
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|Roles
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|Room
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|RoomDept
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|RoomFeature
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|RoomGroup
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|TimetableManager
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|dao
operator|.
name|DepartmentDAO
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|dao
operator|.
name|RoomDAO
import|;
end_import

begin_class
specifier|public
class|class
name|RoomFilterBackend
extends|extends
name|FilterBoxBackend
block|{
specifier|private
name|DistanceMetric
name|iMetrics
decl_stmt|;
specifier|private
specifier|static
name|double
name|EPSILON
init|=
literal|0.000001
decl_stmt|;
specifier|private
specifier|static
name|DecimalFormat
name|sCDF
init|=
operator|new
name|DecimalFormat
argument_list|(
literal|"0.000000"
argument_list|)
decl_stmt|;
specifier|private
specifier|static
enum|enum
name|Size
block|{
name|eq
block|,
name|lt
block|,
name|gt
block|,
name|le
block|,
name|ge
block|}
empty_stmt|;
annotation|@
name|Override
specifier|public
name|void
name|load
parameter_list|(
name|FilterRpcRequest
name|request
parameter_list|,
name|FilterRpcResponse
name|response
parameter_list|)
block|{
name|Set
argument_list|<
name|String
argument_list|>
name|eventDepts
init|=
operator|new
name|HashSet
argument_list|<
name|String
argument_list|>
argument_list|(
name|DepartmentDAO
operator|.
name|getInstance
argument_list|()
operator|.
name|getSession
argument_list|()
operator|.
name|createQuery
argument_list|(
literal|"select distinct d.deptCode from Department d inner join d.timetableManagers m inner join m.managerRoles mr "
operator|+
literal|"where d.session.uniqueId = :sessionId and mr.role.reference=:eventMgr"
argument_list|)
operator|.
name|setLong
argument_list|(
literal|"sessionId"
argument_list|,
name|request
operator|.
name|getSessionId
argument_list|()
argument_list|)
operator|.
name|setString
argument_list|(
literal|"eventMgr"
argument_list|,
name|Roles
operator|.
name|EVENT_MGR_ROLE
argument_list|)
operator|.
name|setCacheable
argument_list|(
literal|true
argument_list|)
operator|.
name|list
argument_list|()
argument_list|)
decl_stmt|;
name|Set
argument_list|<
name|String
argument_list|>
name|eventRoomTypes
init|=
operator|new
name|HashSet
argument_list|<
name|String
argument_list|>
argument_list|(
name|DepartmentDAO
operator|.
name|getInstance
argument_list|()
operator|.
name|getSession
argument_list|()
operator|.
name|createQuery
argument_list|(
literal|"select o.roomType.label from RoomTypeOption o where o.status = 1 and o.session.uniqueId = :sessionId"
argument_list|)
operator|.
name|setLong
argument_list|(
literal|"sessionId"
argument_list|,
name|request
operator|.
name|getSessionId
argument_list|()
argument_list|)
operator|.
name|setCacheable
argument_list|(
literal|true
argument_list|)
operator|.
name|list
argument_list|()
argument_list|)
decl_stmt|;
name|Set
argument_list|<
name|String
argument_list|>
name|departments
init|=
name|request
operator|.
name|getOptions
argument_list|(
literal|"department"
argument_list|)
decl_stmt|;
name|Set
argument_list|<
name|String
argument_list|>
name|userDepts
init|=
literal|null
decl_stmt|;
if|if
condition|(
name|request
operator|.
name|hasOption
argument_list|(
literal|"user"
argument_list|)
condition|)
block|{
name|TimetableManager
name|m
init|=
name|TimetableManager
operator|.
name|findByExternalId
argument_list|(
name|request
operator|.
name|getOption
argument_list|(
literal|"user"
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|m
operator|!=
literal|null
condition|)
block|{
name|userDepts
operator|=
operator|new
name|HashSet
argument_list|<
name|String
argument_list|>
argument_list|()
expr_stmt|;
for|for
control|(
name|Department
name|d
range|:
name|m
operator|.
name|getDepartments
argument_list|()
control|)
if|if
condition|(
name|d
operator|.
name|getSessionId
argument_list|()
operator|.
name|equals
argument_list|(
name|request
operator|.
name|getSessionId
argument_list|()
argument_list|)
condition|)
name|userDepts
operator|.
name|add
argument_list|(
name|d
operator|.
name|getDeptCode
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
name|Map
argument_list|<
name|Long
argument_list|,
name|Entity
argument_list|>
name|types
init|=
operator|new
name|HashMap
argument_list|<
name|Long
argument_list|,
name|Entity
argument_list|>
argument_list|()
decl_stmt|;
for|for
control|(
name|Location
name|location
range|:
name|locations
argument_list|(
name|request
operator|.
name|getSessionId
argument_list|()
argument_list|,
name|request
operator|.
name|getOptions
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|-
literal|1
argument_list|,
literal|null
argument_list|,
literal|"type"
argument_list|)
control|)
block|{
name|Entity
name|type
init|=
name|types
operator|.
name|get
argument_list|(
name|location
operator|.
name|getRoomType
argument_list|()
operator|.
name|getUniqueId
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
name|type
operator|==
literal|null
condition|)
block|{
name|type
operator|=
operator|new
name|Entity
argument_list|(
name|location
operator|.
name|getRoomType
argument_list|()
operator|.
name|getUniqueId
argument_list|()
argument_list|,
name|location
operator|.
name|getRoomType
argument_list|()
operator|.
name|getReference
argument_list|()
argument_list|,
name|location
operator|.
name|getRoomType
argument_list|()
operator|.
name|getLabel
argument_list|()
argument_list|)
expr_stmt|;
name|types
operator|.
name|put
argument_list|(
name|type
operator|.
name|getUniqueId
argument_list|()
argument_list|,
name|type
argument_list|)
expr_stmt|;
block|}
name|type
operator|.
name|incCount
argument_list|()
expr_stmt|;
block|}
name|response
operator|.
name|add
argument_list|(
literal|"type"
argument_list|,
operator|new
name|TreeSet
argument_list|<
name|Entity
argument_list|>
argument_list|(
name|types
operator|.
name|values
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|Map
argument_list|<
name|Long
argument_list|,
name|Entity
argument_list|>
name|features
init|=
operator|new
name|HashMap
argument_list|<
name|Long
argument_list|,
name|Entity
argument_list|>
argument_list|()
decl_stmt|;
for|for
control|(
name|Location
name|location
range|:
name|locations
argument_list|(
name|request
operator|.
name|getSessionId
argument_list|()
argument_list|,
name|request
operator|.
name|getOptions
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|-
literal|1
argument_list|,
literal|null
argument_list|,
literal|null
argument_list|)
control|)
block|{
for|for
control|(
name|RoomFeature
name|rf
range|:
name|location
operator|.
name|getFeatures
argument_list|()
control|)
block|{
if|if
condition|(
name|rf
operator|instanceof
name|GlobalRoomFeature
operator|||
operator|(
name|rf
operator|instanceof
name|DepartmentRoomFeature
operator|&&
name|departments
operator|!=
literal|null
operator|&&
name|departments
operator|.
name|contains
argument_list|(
operator|(
operator|(
name|DepartmentRoomFeature
operator|)
name|rf
operator|)
operator|.
name|getDepartment
argument_list|()
operator|.
name|getDeptCode
argument_list|()
argument_list|)
operator|)
condition|)
block|{
name|Entity
name|feature
init|=
name|features
operator|.
name|get
argument_list|(
name|rf
operator|.
name|getUniqueId
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
name|feature
operator|==
literal|null
condition|)
block|{
name|feature
operator|=
operator|new
name|Entity
argument_list|(
name|rf
operator|.
name|getUniqueId
argument_list|()
argument_list|,
name|rf
operator|.
name|getAbbv
argument_list|()
argument_list|,
name|rf
operator|.
name|getLabel
argument_list|()
argument_list|)
expr_stmt|;
name|features
operator|.
name|put
argument_list|(
name|feature
operator|.
name|getUniqueId
argument_list|()
argument_list|,
name|feature
argument_list|)
expr_stmt|;
block|}
name|feature
operator|.
name|incCount
argument_list|()
expr_stmt|;
block|}
block|}
block|}
name|response
operator|.
name|add
argument_list|(
literal|"feature"
argument_list|,
operator|new
name|TreeSet
argument_list|<
name|Entity
argument_list|>
argument_list|(
name|features
operator|.
name|values
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|Map
argument_list|<
name|Long
argument_list|,
name|Entity
argument_list|>
name|groups
init|=
operator|new
name|HashMap
argument_list|<
name|Long
argument_list|,
name|Entity
argument_list|>
argument_list|()
decl_stmt|;
for|for
control|(
name|Location
name|location
range|:
name|locations
argument_list|(
name|request
operator|.
name|getSessionId
argument_list|()
argument_list|,
name|request
operator|.
name|getOptions
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|-
literal|1
argument_list|,
literal|null
argument_list|,
literal|"group"
argument_list|)
control|)
block|{
for|for
control|(
name|RoomGroup
name|rg
range|:
name|location
operator|.
name|getRoomGroups
argument_list|()
control|)
block|{
if|if
condition|(
name|rg
operator|.
name|isGlobal
argument_list|()
operator|||
operator|(
name|departments
operator|!=
literal|null
operator|&&
name|departments
operator|.
name|contains
argument_list|(
name|rg
operator|.
name|getDepartment
argument_list|()
operator|.
name|getDeptCode
argument_list|()
argument_list|)
operator|)
condition|)
block|{
name|Entity
name|group
init|=
name|groups
operator|.
name|get
argument_list|(
name|rg
operator|.
name|getUniqueId
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
name|group
operator|==
literal|null
condition|)
block|{
name|group
operator|=
operator|new
name|Entity
argument_list|(
name|rg
operator|.
name|getUniqueId
argument_list|()
argument_list|,
name|rg
operator|.
name|getAbbv
argument_list|()
argument_list|,
name|rg
operator|.
name|getName
argument_list|()
argument_list|)
expr_stmt|;
name|groups
operator|.
name|put
argument_list|(
name|group
operator|.
name|getUniqueId
argument_list|()
argument_list|,
name|group
argument_list|)
expr_stmt|;
block|}
name|group
operator|.
name|incCount
argument_list|()
expr_stmt|;
block|}
block|}
block|}
name|response
operator|.
name|add
argument_list|(
literal|"group"
argument_list|,
operator|new
name|TreeSet
argument_list|<
name|Entity
argument_list|>
argument_list|(
name|groups
operator|.
name|values
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|Map
argument_list|<
name|Long
argument_list|,
name|Entity
argument_list|>
name|buildings
init|=
operator|new
name|HashMap
argument_list|<
name|Long
argument_list|,
name|Entity
argument_list|>
argument_list|()
decl_stmt|;
for|for
control|(
name|Location
name|location
range|:
name|locations
argument_list|(
name|request
operator|.
name|getSessionId
argument_list|()
argument_list|,
name|request
operator|.
name|getOptions
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|-
literal|1
argument_list|,
literal|null
argument_list|,
literal|"building"
argument_list|)
control|)
block|{
if|if
condition|(
name|location
operator|instanceof
name|Room
condition|)
block|{
name|Room
name|room
init|=
operator|(
name|Room
operator|)
name|location
decl_stmt|;
name|Entity
name|building
init|=
name|buildings
operator|.
name|get
argument_list|(
name|room
operator|.
name|getBuilding
argument_list|()
operator|.
name|getUniqueId
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
name|building
operator|==
literal|null
condition|)
block|{
name|building
operator|=
operator|new
name|Entity
argument_list|(
name|room
operator|.
name|getBuilding
argument_list|()
operator|.
name|getUniqueId
argument_list|()
argument_list|,
name|room
operator|.
name|getBuilding
argument_list|()
operator|.
name|getAbbreviation
argument_list|()
argument_list|,
name|room
operator|.
name|getBuilding
argument_list|()
operator|.
name|getAbbrName
argument_list|()
argument_list|)
expr_stmt|;
name|buildings
operator|.
name|put
argument_list|(
name|building
operator|.
name|getUniqueId
argument_list|()
argument_list|,
name|building
argument_list|)
expr_stmt|;
block|}
name|building
operator|.
name|incCount
argument_list|()
expr_stmt|;
block|}
block|}
name|response
operator|.
name|add
argument_list|(
literal|"building"
argument_list|,
operator|new
name|TreeSet
argument_list|<
name|Entity
argument_list|>
argument_list|(
name|buildings
operator|.
name|values
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|Entity
name|event
init|=
operator|new
name|Entity
argument_list|(
operator|-
literal|1l
argument_list|,
literal|"Event"
argument_list|,
literal|"Event Rooms"
argument_list|)
decl_stmt|;
name|Entity
name|managed
init|=
operator|new
name|Entity
argument_list|(
operator|-
literal|2l
argument_list|,
literal|"Managed"
argument_list|,
literal|"Managed Rooms"
argument_list|)
decl_stmt|;
name|Entity
name|examFinal
init|=
operator|new
name|Entity
argument_list|(
operator|-
literal|3l
argument_list|,
literal|"Final"
argument_list|,
literal|"Final Examination Rooms"
argument_list|)
decl_stmt|;
name|Entity
name|examMidterm
init|=
operator|new
name|Entity
argument_list|(
operator|-
literal|4l
argument_list|,
literal|"Midterm"
argument_list|,
literal|"Midterm Examination Rooms"
argument_list|)
decl_stmt|;
name|Map
argument_list|<
name|Long
argument_list|,
name|Entity
argument_list|>
name|depts
init|=
operator|new
name|HashMap
argument_list|<
name|Long
argument_list|,
name|Entity
argument_list|>
argument_list|()
decl_stmt|;
for|for
control|(
name|Location
name|location
range|:
name|locations
argument_list|(
name|request
operator|.
name|getSessionId
argument_list|()
argument_list|,
name|request
operator|.
name|getOptions
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|-
literal|1
argument_list|,
literal|null
argument_list|,
literal|"department"
argument_list|)
control|)
block|{
name|boolean
name|isManaged
init|=
literal|false
decl_stmt|;
for|for
control|(
name|RoomDept
name|rd
range|:
name|location
operator|.
name|getRoomDepts
argument_list|()
control|)
block|{
if|if
condition|(
name|rd
operator|.
name|isControl
argument_list|()
operator|&&
name|eventRoomTypes
operator|.
name|contains
argument_list|(
name|location
operator|.
name|getRoomType
argument_list|()
operator|.
name|getLabel
argument_list|()
argument_list|)
operator|&&
name|eventDepts
operator|.
name|contains
argument_list|(
name|rd
operator|.
name|getDepartment
argument_list|()
operator|.
name|getDeptCode
argument_list|()
argument_list|)
condition|)
name|event
operator|.
name|incCount
argument_list|()
expr_stmt|;
name|Entity
name|department
init|=
name|depts
operator|.
name|get
argument_list|(
name|rd
operator|.
name|getDepartment
argument_list|()
operator|.
name|getUniqueId
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
name|department
operator|==
literal|null
condition|)
block|{
name|department
operator|=
operator|new
name|Entity
argument_list|(
name|rd
operator|.
name|getDepartment
argument_list|()
operator|.
name|getUniqueId
argument_list|()
argument_list|,
name|rd
operator|.
name|getDepartment
argument_list|()
operator|.
name|getDeptCode
argument_list|()
argument_list|,
name|rd
operator|.
name|getDepartment
argument_list|()
operator|.
name|getDeptCode
argument_list|()
operator|+
literal|" - "
operator|+
name|rd
operator|.
name|getDepartment
argument_list|()
operator|.
name|getName
argument_list|()
operator|+
operator|(
name|rd
operator|.
name|getDepartment
argument_list|()
operator|.
name|isExternalManager
argument_list|()
condition|?
literal|" ("
operator|+
name|rd
operator|.
name|getDepartment
argument_list|()
operator|.
name|getExternalMgrLabel
argument_list|()
operator|+
literal|")"
else|:
literal|""
operator|)
argument_list|)
expr_stmt|;
name|depts
operator|.
name|put
argument_list|(
name|department
operator|.
name|getUniqueId
argument_list|()
argument_list|,
name|department
argument_list|)
expr_stmt|;
block|}
name|department
operator|.
name|incCount
argument_list|()
expr_stmt|;
if|if
condition|(
name|userDepts
operator|!=
literal|null
operator|&&
name|userDepts
operator|.
name|contains
argument_list|(
name|rd
operator|.
name|getDepartment
argument_list|()
operator|.
name|getDeptCode
argument_list|()
argument_list|)
condition|)
name|isManaged
operator|=
literal|true
expr_stmt|;
block|}
if|if
condition|(
name|location
operator|.
name|isExamEnabled
argument_list|(
name|Exam
operator|.
name|sExamTypeFinal
argument_list|)
condition|)
name|examFinal
operator|.
name|incCount
argument_list|()
expr_stmt|;
if|if
condition|(
name|location
operator|.
name|isExamEnabled
argument_list|(
name|Exam
operator|.
name|sExamTypeMidterm
argument_list|)
condition|)
name|examMidterm
operator|.
name|incCount
argument_list|()
expr_stmt|;
if|if
condition|(
name|isManaged
condition|)
name|managed
operator|.
name|incCount
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|event
operator|.
name|getCount
argument_list|()
operator|>
literal|0
condition|)
name|response
operator|.
name|add
argument_list|(
literal|"department"
argument_list|,
name|event
argument_list|)
expr_stmt|;
if|if
condition|(
name|managed
operator|.
name|getCount
argument_list|()
operator|>
literal|0
condition|)
name|response
operator|.
name|add
argument_list|(
literal|"department"
argument_list|,
name|managed
argument_list|)
expr_stmt|;
if|if
condition|(
name|examFinal
operator|.
name|getCount
argument_list|()
operator|>
literal|0
condition|)
name|response
operator|.
name|add
argument_list|(
literal|"department"
argument_list|,
name|examFinal
argument_list|)
expr_stmt|;
if|if
condition|(
name|examMidterm
operator|.
name|getCount
argument_list|()
operator|>
literal|0
condition|)
name|response
operator|.
name|add
argument_list|(
literal|"department"
argument_list|,
name|examMidterm
argument_list|)
expr_stmt|;
name|response
operator|.
name|add
argument_list|(
literal|"department"
argument_list|,
operator|new
name|TreeSet
argument_list|<
name|Entity
argument_list|>
argument_list|(
name|depts
operator|.
name|values
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
specifier|public
name|List
argument_list|<
name|Location
argument_list|>
name|locations
parameter_list|(
name|Long
name|sessionId
parameter_list|,
name|Map
argument_list|<
name|String
argument_list|,
name|Set
argument_list|<
name|String
argument_list|>
argument_list|>
name|options
parameter_list|,
name|Query
name|query
parameter_list|,
name|int
name|limit
parameter_list|,
name|Map
argument_list|<
name|Long
argument_list|,
name|Double
argument_list|>
name|room2distance
parameter_list|,
name|String
name|ignoreCommand
parameter_list|)
block|{
name|org
operator|.
name|hibernate
operator|.
name|Session
name|hibSession
init|=
name|RoomDAO
operator|.
name|getInstance
argument_list|()
operator|.
name|getSession
argument_list|()
decl_stmt|;
name|Set
argument_list|<
name|String
argument_list|>
name|type
init|=
operator|(
name|options
operator|==
literal|null
operator|||
literal|"type"
operator|.
name|equals
argument_list|(
name|ignoreCommand
argument_list|)
condition|?
literal|null
else|:
name|options
operator|.
name|get
argument_list|(
literal|"type"
argument_list|)
operator|)
decl_stmt|;
name|Set
argument_list|<
name|String
argument_list|>
name|feature
init|=
operator|(
name|options
operator|==
literal|null
operator|||
literal|"feature"
operator|.
name|equals
argument_list|(
name|ignoreCommand
argument_list|)
condition|?
literal|null
else|:
name|options
operator|.
name|get
argument_list|(
literal|"feature"
argument_list|)
operator|)
decl_stmt|;
name|Set
argument_list|<
name|String
argument_list|>
name|group
init|=
operator|(
name|options
operator|==
literal|null
operator|||
literal|"group"
operator|.
name|equals
argument_list|(
name|ignoreCommand
argument_list|)
condition|?
literal|null
else|:
name|options
operator|.
name|get
argument_list|(
literal|"group"
argument_list|)
operator|)
decl_stmt|;
name|Set
argument_list|<
name|String
argument_list|>
name|building
init|=
operator|(
name|options
operator|==
literal|null
operator|||
literal|"building"
operator|.
name|equals
argument_list|(
name|ignoreCommand
argument_list|)
condition|?
literal|null
else|:
name|options
operator|.
name|get
argument_list|(
literal|"building"
argument_list|)
operator|)
decl_stmt|;
name|Set
argument_list|<
name|String
argument_list|>
name|department
init|=
operator|(
name|options
operator|==
literal|null
operator|||
literal|"department"
operator|.
name|equals
argument_list|(
name|ignoreCommand
argument_list|)
condition|?
literal|null
else|:
name|options
operator|.
name|get
argument_list|(
literal|"department"
argument_list|)
operator|)
decl_stmt|;
name|Set
argument_list|<
name|String
argument_list|>
name|groupFeaturedept
init|=
operator|(
name|options
operator|==
literal|null
condition|?
literal|null
else|:
name|options
operator|.
name|get
argument_list|(
literal|"department"
argument_list|)
operator|)
decl_stmt|;
name|Set
argument_list|<
name|String
argument_list|>
name|size
init|=
operator|(
name|options
operator|==
literal|null
operator|||
literal|"size"
operator|.
name|equals
argument_list|(
name|ignoreCommand
argument_list|)
condition|?
literal|null
else|:
name|options
operator|.
name|get
argument_list|(
literal|"size"
argument_list|)
operator|)
decl_stmt|;
name|Set
argument_list|<
name|String
argument_list|>
name|flag
init|=
operator|(
name|options
operator|==
literal|null
operator|||
literal|"flag"
operator|.
name|equals
argument_list|(
name|ignoreCommand
argument_list|)
condition|?
literal|null
else|:
name|options
operator|.
name|get
argument_list|(
literal|"flag"
argument_list|)
operator|)
decl_stmt|;
name|Set
argument_list|<
name|String
argument_list|>
name|user
init|=
operator|(
name|options
operator|==
literal|null
operator|||
literal|"user"
operator|.
name|equals
argument_list|(
name|ignoreCommand
argument_list|)
condition|?
literal|null
else|:
name|options
operator|.
name|get
argument_list|(
literal|"user"
argument_list|)
operator|)
decl_stmt|;
name|int
name|min
init|=
literal|0
decl_stmt|,
name|max
init|=
name|Integer
operator|.
name|MAX_VALUE
decl_stmt|;
name|boolean
name|nearby
init|=
operator|(
name|flag
operator|!=
literal|null
operator|&&
name|flag
operator|.
name|contains
argument_list|(
literal|"nearby"
argument_list|)
operator|)
decl_stmt|;
if|if
condition|(
name|size
operator|!=
literal|null
operator|&&
operator|!
name|size
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|Size
name|prefix
init|=
name|Size
operator|.
name|eq
decl_stmt|;
name|String
name|number
init|=
name|size
operator|.
name|iterator
argument_list|()
operator|.
name|next
argument_list|()
decl_stmt|;
if|if
condition|(
name|number
operator|.
name|startsWith
argument_list|(
literal|"<="
argument_list|)
condition|)
block|{
name|prefix
operator|=
name|Size
operator|.
name|le
expr_stmt|;
name|number
operator|=
name|number
operator|.
name|substring
argument_list|(
literal|2
argument_list|)
expr_stmt|;
block|}
if|else if
condition|(
name|number
operator|.
name|startsWith
argument_list|(
literal|">="
argument_list|)
condition|)
block|{
name|prefix
operator|=
name|Size
operator|.
name|ge
expr_stmt|;
name|number
operator|=
name|number
operator|.
name|substring
argument_list|(
literal|2
argument_list|)
expr_stmt|;
block|}
if|else if
condition|(
name|number
operator|.
name|startsWith
argument_list|(
literal|"<"
argument_list|)
condition|)
block|{
name|prefix
operator|=
name|Size
operator|.
name|lt
expr_stmt|;
name|number
operator|=
name|number
operator|.
name|substring
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|else if
condition|(
name|number
operator|.
name|startsWith
argument_list|(
literal|">"
argument_list|)
condition|)
block|{
name|prefix
operator|=
name|Size
operator|.
name|gt
expr_stmt|;
name|number
operator|=
name|number
operator|.
name|substring
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|else if
condition|(
name|number
operator|.
name|startsWith
argument_list|(
literal|"="
argument_list|)
condition|)
block|{
name|prefix
operator|=
name|Size
operator|.
name|eq
expr_stmt|;
name|number
operator|=
name|number
operator|.
name|substring
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
try|try
block|{
name|int
name|a
init|=
name|Integer
operator|.
name|parseInt
argument_list|(
name|number
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|prefix
condition|)
block|{
case|case
name|eq
case|:
name|min
operator|=
name|max
operator|=
name|a
expr_stmt|;
break|break;
comment|// = a
case|case
name|le
case|:
name|max
operator|=
name|a
expr_stmt|;
break|break;
comment|//<= a
case|case
name|ge
case|:
name|min
operator|=
name|a
expr_stmt|;
break|break;
comment|//>= a
case|case
name|lt
case|:
name|max
operator|=
name|a
operator|-
literal|1
expr_stmt|;
break|break;
comment|//< a
case|case
name|gt
case|:
name|min
operator|=
name|a
operator|+
literal|1
expr_stmt|;
break|break;
comment|//> a
block|}
block|}
catch|catch
parameter_list|(
name|NumberFormatException
name|e
parameter_list|)
block|{
block|}
if|if
condition|(
name|number
operator|.
name|contains
argument_list|(
literal|".."
argument_list|)
condition|)
block|{
try|try
block|{
name|String
name|a
init|=
name|number
operator|.
name|substring
argument_list|(
literal|0
argument_list|,
name|number
operator|.
name|indexOf
argument_list|(
literal|'.'
argument_list|)
argument_list|)
decl_stmt|;
name|String
name|b
init|=
name|number
operator|.
name|substring
argument_list|(
name|number
operator|.
name|indexOf
argument_list|(
literal|".."
argument_list|)
operator|+
literal|2
argument_list|)
decl_stmt|;
name|min
operator|=
name|Integer
operator|.
name|parseInt
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|max
operator|=
name|Integer
operator|.
name|parseInt
argument_list|(
name|b
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|NumberFormatException
name|e
parameter_list|)
block|{
block|}
block|}
block|}
name|List
argument_list|<
name|Location
argument_list|>
name|locations
init|=
operator|(
name|department
operator|!=
literal|null
operator|&&
name|department
operator|.
name|contains
argument_list|(
literal|"Event"
argument_list|)
condition|?
operator|(
name|List
argument_list|<
name|Location
argument_list|>
operator|)
name|hibSession
operator|.
name|createQuery
argument_list|(
literal|"select distinct l from"
operator|+
literal|" Location l inner join l.roomDepts rd"
operator|+
literal|" inner join rd.department.timetableManagers m"
operator|+
literal|" inner join m.managerRoles mr "
operator|+
literal|" left outer join l.roomType t "
operator|+
literal|" left outer join l.roomGroups g "
operator|+
literal|" left outer join l.features f "
operator|+
literal|" ,RoomTypeOption o"
operator|+
literal|" where"
operator|+
literal|" l.session.uniqueId = :sessionId and"
operator|+
literal|" rd.control=true and mr.role.reference=:eventMgr and"
operator|+
literal|" o.status = 1 and o.roomType = l.roomType and o.session = l.session"
argument_list|)
operator|.
name|setLong
argument_list|(
literal|"sessionId"
argument_list|,
name|sessionId
argument_list|)
operator|.
name|setString
argument_list|(
literal|"eventMgr"
argument_list|,
name|Roles
operator|.
name|EVENT_MGR_ROLE
argument_list|)
operator|.
name|setCacheable
argument_list|(
literal|true
argument_list|)
operator|.
name|list
argument_list|()
else|:
name|department
operator|!=
literal|null
operator|&&
name|department
operator|.
name|contains
argument_list|(
literal|"Managed"
argument_list|)
operator|&&
name|user
operator|!=
literal|null
operator|&&
operator|!
name|user
operator|.
name|isEmpty
argument_list|()
condition|?
operator|(
name|List
argument_list|<
name|Location
argument_list|>
operator|)
name|hibSession
operator|.
name|createQuery
argument_list|(
literal|"select distinct l from"
operator|+
literal|" Location l inner join l.roomDepts rd"
operator|+
literal|" left outer join l.roomType t "
operator|+
literal|" left outer join l.roomGroups g "
operator|+
literal|" left outer join l.features f "
operator|+
literal|" inner join rd.department.timetableManagers m"
operator|+
literal|" left outer join m.managerRoles mr "
operator|+
literal|" where"
operator|+
literal|" l.session.uniqueId = :sessionId and m.externalUniqueId = :user"
argument_list|)
operator|.
name|setLong
argument_list|(
literal|"sessionId"
argument_list|,
name|sessionId
argument_list|)
operator|.
name|setString
argument_list|(
literal|"user"
argument_list|,
name|user
operator|.
name|iterator
argument_list|()
operator|.
name|next
argument_list|()
argument_list|)
operator|.
name|setCacheable
argument_list|(
literal|true
argument_list|)
operator|.
name|list
argument_list|()
else|:
operator|(
name|List
argument_list|<
name|Location
argument_list|>
operator|)
name|hibSession
operator|.
name|createQuery
argument_list|(
literal|"select distinct l from"
operator|+
literal|" Location l left outer join l.roomDepts rd"
operator|+
literal|" left outer join l.roomType t "
operator|+
literal|" left outer join l.roomGroups g "
operator|+
literal|" left outer join l.features f "
operator|+
literal|" left outer join rd.department.timetableManagers m"
operator|+
literal|" left outer join m.managerRoles mr "
operator|+
literal|" where"
operator|+
literal|" l.session.uniqueId = :sessionId"
argument_list|)
operator|.
name|setLong
argument_list|(
literal|"sessionId"
argument_list|,
name|sessionId
argument_list|)
operator|.
name|setCacheable
argument_list|(
literal|true
argument_list|)
operator|.
name|list
argument_list|()
operator|)
decl_stmt|;
name|List
argument_list|<
name|Location
argument_list|>
name|ret
init|=
operator|new
name|ArrayList
argument_list|<
name|Location
argument_list|>
argument_list|()
decl_stmt|;
name|locations
label|:
for|for
control|(
name|Location
name|location
range|:
name|locations
control|)
block|{
if|if
condition|(
name|size
operator|!=
literal|null
operator|&&
operator|!
name|size
operator|.
name|isEmpty
argument_list|()
operator|&&
operator|(
name|location
operator|.
name|getCapacity
argument_list|()
operator|<
name|min
operator|||
name|location
operator|.
name|getCapacity
argument_list|()
operator|>
name|max
operator|)
condition|)
continue|continue;
if|if
condition|(
name|query
operator|!=
literal|null
operator|&&
operator|!
name|query
operator|.
name|match
argument_list|(
operator|new
name|LocationMatcher
argument_list|(
name|location
argument_list|)
argument_list|)
condition|)
continue|continue;
if|if
condition|(
name|type
operator|!=
literal|null
operator|&&
operator|!
name|type
operator|.
name|isEmpty
argument_list|()
operator|&&
operator|!
name|type
operator|.
name|contains
argument_list|(
name|location
operator|.
name|getRoomType
argument_list|()
operator|.
name|getLabel
argument_list|()
argument_list|)
condition|)
continue|continue;
if|if
condition|(
name|building
operator|!=
literal|null
operator|&&
operator|!
name|building
operator|.
name|isEmpty
argument_list|()
operator|&&
operator|(
operator|!
operator|(
name|location
operator|instanceof
name|Room
operator|)
operator|||
operator|!
name|building
operator|.
name|contains
argument_list|(
operator|(
operator|(
name|Room
operator|)
name|location
operator|)
operator|.
name|getBuilding
argument_list|()
operator|.
name|getAbbreviation
argument_list|()
argument_list|)
operator|)
condition|)
continue|continue;
if|if
condition|(
name|feature
operator|!=
literal|null
operator|&&
operator|!
name|feature
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
for|for
control|(
name|String
name|f
range|:
name|feature
control|)
block|{
name|boolean
name|found
init|=
literal|false
decl_stmt|;
for|for
control|(
name|RoomFeature
name|rf
range|:
name|location
operator|.
name|getFeatures
argument_list|()
control|)
if|if
condition|(
name|rf
operator|instanceof
name|GlobalRoomFeature
condition|)
block|{
if|if
condition|(
name|f
operator|.
name|equals
argument_list|(
name|rf
operator|.
name|getLabel
argument_list|()
argument_list|)
condition|)
block|{
name|found
operator|=
literal|true
expr_stmt|;
break|break;
block|}
block|}
if|else if
condition|(
name|rf
operator|instanceof
name|DepartmentRoomFeature
operator|&&
name|groupFeaturedept
operator|!=
literal|null
operator|&&
operator|!
name|groupFeaturedept
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
if|if
condition|(
name|groupFeaturedept
operator|.
name|contains
argument_list|(
operator|(
operator|(
name|DepartmentRoomFeature
operator|)
name|rf
operator|)
operator|.
name|getDepartment
argument_list|()
operator|.
name|getDeptCode
argument_list|()
argument_list|)
operator|&&
name|f
operator|.
name|equals
argument_list|(
name|rf
operator|.
name|getLabel
argument_list|()
argument_list|)
condition|)
block|{
name|found
operator|=
literal|true
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
operator|!
name|found
condition|)
continue|continue
name|locations
continue|;
block|}
block|}
if|if
condition|(
name|group
operator|!=
literal|null
operator|&&
operator|!
name|group
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|boolean
name|found
init|=
literal|false
decl_stmt|;
for|for
control|(
name|RoomGroup
name|rg
range|:
name|location
operator|.
name|getRoomGroups
argument_list|()
control|)
block|{
if|if
condition|(
name|rg
operator|.
name|isGlobal
argument_list|()
condition|)
block|{
if|if
condition|(
name|group
operator|.
name|contains
argument_list|(
name|rg
operator|.
name|getName
argument_list|()
argument_list|)
condition|)
block|{
name|found
operator|=
literal|true
expr_stmt|;
break|break;
block|}
block|}
if|else if
condition|(
name|groupFeaturedept
operator|!=
literal|null
operator|&&
operator|!
name|groupFeaturedept
operator|.
name|isEmpty
argument_list|()
operator|&&
name|groupFeaturedept
operator|.
name|contains
argument_list|(
name|rg
operator|.
name|getDepartment
argument_list|()
operator|.
name|getDeptCode
argument_list|()
argument_list|)
condition|)
block|{
if|if
condition|(
name|group
operator|.
name|contains
argument_list|(
name|rg
operator|.
name|getName
argument_list|()
argument_list|)
condition|)
block|{
name|found
operator|=
literal|true
expr_stmt|;
break|break;
block|}
block|}
block|}
if|if
condition|(
operator|!
name|found
condition|)
continue|continue;
block|}
if|if
condition|(
name|department
operator|==
literal|null
operator|||
name|department
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
block|}
if|else if
condition|(
name|department
operator|.
name|contains
argument_list|(
literal|"Final"
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|location
operator|.
name|isExamEnabled
argument_list|(
name|Exam
operator|.
name|sExamTypeFinal
argument_list|)
condition|)
continue|continue;
block|}
if|else if
condition|(
name|department
operator|.
name|contains
argument_list|(
literal|"Midterm"
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|location
operator|.
name|isExamEnabled
argument_list|(
name|Exam
operator|.
name|sExamTypeMidterm
argument_list|)
condition|)
continue|continue;
block|}
if|else if
condition|(
operator|!
name|department
operator|.
name|contains
argument_list|(
literal|"Event"
argument_list|)
operator|&&
operator|!
name|department
operator|.
name|contains
argument_list|(
literal|"Managed"
argument_list|)
condition|)
block|{
name|boolean
name|found
init|=
literal|false
decl_stmt|;
for|for
control|(
name|RoomDept
name|rd
range|:
name|location
operator|.
name|getRoomDepts
argument_list|()
control|)
if|if
condition|(
name|department
operator|.
name|contains
argument_list|(
name|rd
operator|.
name|getDepartment
argument_list|()
operator|.
name|getDeptCode
argument_list|()
argument_list|)
condition|)
block|{
name|found
operator|=
literal|true
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|!
name|found
condition|)
continue|continue;
block|}
name|ret
operator|.
name|add
argument_list|(
name|location
argument_list|)
expr_stmt|;
block|}
specifier|final
name|Map
argument_list|<
name|Long
argument_list|,
name|Double
argument_list|>
name|distances
init|=
operator|(
name|room2distance
operator|==
literal|null
condition|?
operator|new
name|Hashtable
argument_list|<
name|Long
argument_list|,
name|Double
argument_list|>
argument_list|()
else|:
name|room2distance
operator|)
decl_stmt|;
if|if
condition|(
name|nearby
operator|&&
name|building
operator|!=
literal|null
operator|&&
operator|!
name|building
operator|.
name|isEmpty
argument_list|()
operator|&&
operator|(
name|limit
operator|<=
literal|0
operator|||
name|ret
operator|.
name|size
argument_list|()
operator|<
name|limit
operator|)
condition|)
block|{
name|double
name|allowedDistance
init|=
name|Double
operator|.
name|parseDouble
argument_list|(
name|ApplicationProperties
operator|.
name|getProperty
argument_list|(
literal|"tmtbl.events.nearByDistance"
argument_list|,
literal|"670"
argument_list|)
argument_list|)
decl_stmt|;
comment|// 670m by default
name|Set
argument_list|<
name|Coordinates
argument_list|>
name|coord
init|=
operator|new
name|HashSet
argument_list|<
name|Coordinates
argument_list|>
argument_list|()
decl_stmt|;
for|for
control|(
name|Location
name|location
range|:
name|ret
control|)
name|coord
operator|.
name|add
argument_list|(
operator|new
name|Coordinates
argument_list|(
name|location
argument_list|)
argument_list|)
expr_stmt|;
name|String
name|buildingOnlyFilter
init|=
literal|""
decl_stmt|;
for|for
control|(
name|String
name|b
range|:
name|building
control|)
name|buildingOnlyFilter
operator|+=
operator|(
name|buildingOnlyFilter
operator|.
name|isEmpty
argument_list|()
condition|?
literal|""
else|:
literal|" or "
operator|)
operator|+
literal|"b.abbreviation = '"
operator|+
name|b
operator|+
literal|"'"
expr_stmt|;
if|if
condition|(
name|coord
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
for|for
control|(
name|Building
name|b
range|:
operator|(
name|List
argument_list|<
name|Building
argument_list|>
operator|)
name|hibSession
operator|.
name|createQuery
argument_list|(
literal|"select b from Building b where"
operator|+
literal|" b.session.uniqueId = :sessionId and ("
operator|+
name|buildingOnlyFilter
operator|+
literal|")"
argument_list|)
operator|.
name|setLong
argument_list|(
literal|"sessionId"
argument_list|,
name|sessionId
argument_list|)
operator|.
name|list
argument_list|()
control|)
block|{
name|coord
operator|.
name|add
argument_list|(
operator|new
name|Coordinates
argument_list|(
operator|-
name|b
operator|.
name|getUniqueId
argument_list|()
argument_list|,
name|b
operator|.
name|getCoordinateX
argument_list|()
argument_list|,
name|b
operator|.
name|getCoordinateY
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|!
name|coord
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|locations
label|:
for|for
control|(
name|Location
name|location
range|:
name|locations
control|)
block|{
if|if
condition|(
name|size
operator|!=
literal|null
operator|&&
operator|!
name|size
operator|.
name|isEmpty
argument_list|()
operator|&&
operator|(
name|location
operator|.
name|getCapacity
argument_list|()
operator|<
name|min
operator|||
name|location
operator|.
name|getCapacity
argument_list|()
operator|>
name|max
operator|)
condition|)
continue|continue;
if|if
condition|(
name|query
operator|!=
literal|null
operator|&&
operator|!
name|query
operator|.
name|match
argument_list|(
operator|new
name|LocationMatcher
argument_list|(
name|location
argument_list|)
argument_list|)
condition|)
continue|continue;
if|if
condition|(
name|type
operator|!=
literal|null
operator|&&
operator|!
name|type
operator|.
name|isEmpty
argument_list|()
operator|&&
operator|!
name|type
operator|.
name|contains
argument_list|(
name|location
operator|.
name|getRoomType
argument_list|()
operator|.
name|getLabel
argument_list|()
argument_list|)
condition|)
continue|continue;
if|if
condition|(
name|feature
operator|!=
literal|null
operator|&&
operator|!
name|feature
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
for|for
control|(
name|String
name|f
range|:
name|feature
control|)
block|{
name|boolean
name|found
init|=
literal|false
decl_stmt|;
for|for
control|(
name|RoomFeature
name|rf
range|:
name|location
operator|.
name|getFeatures
argument_list|()
control|)
if|if
condition|(
name|rf
operator|instanceof
name|GlobalRoomFeature
condition|)
block|{
if|if
condition|(
name|f
operator|.
name|equals
argument_list|(
name|rf
operator|.
name|getLabel
argument_list|()
argument_list|)
condition|)
block|{
name|found
operator|=
literal|true
expr_stmt|;
break|break;
block|}
block|}
if|else if
condition|(
name|rf
operator|instanceof
name|DepartmentRoomFeature
operator|&&
name|groupFeaturedept
operator|!=
literal|null
operator|&&
operator|!
name|groupFeaturedept
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
if|if
condition|(
name|groupFeaturedept
operator|.
name|contains
argument_list|(
operator|(
operator|(
name|DepartmentRoomFeature
operator|)
name|rf
operator|)
operator|.
name|getDepartment
argument_list|()
operator|.
name|getDeptCode
argument_list|()
argument_list|)
operator|&&
name|f
operator|.
name|equals
argument_list|(
name|rf
operator|.
name|getLabel
argument_list|()
argument_list|)
condition|)
block|{
name|found
operator|=
literal|true
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
operator|!
name|found
condition|)
continue|continue
name|locations
continue|;
block|}
block|}
if|if
condition|(
name|group
operator|!=
literal|null
operator|&&
operator|!
name|group
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|boolean
name|found
init|=
literal|false
decl_stmt|;
for|for
control|(
name|RoomGroup
name|rg
range|:
name|location
operator|.
name|getRoomGroups
argument_list|()
control|)
block|{
if|if
condition|(
name|rg
operator|.
name|isGlobal
argument_list|()
condition|)
block|{
if|if
condition|(
name|group
operator|.
name|contains
argument_list|(
name|rg
operator|.
name|getName
argument_list|()
argument_list|)
condition|)
block|{
name|found
operator|=
literal|true
expr_stmt|;
break|break;
block|}
block|}
if|else if
condition|(
name|groupFeaturedept
operator|!=
literal|null
operator|&&
operator|!
name|groupFeaturedept
operator|.
name|isEmpty
argument_list|()
operator|&&
name|groupFeaturedept
operator|.
name|contains
argument_list|(
name|rg
operator|.
name|getDepartment
argument_list|()
operator|.
name|getDeptCode
argument_list|()
argument_list|)
condition|)
block|{
if|if
condition|(
name|group
operator|.
name|contains
argument_list|(
name|rg
operator|.
name|getName
argument_list|()
argument_list|)
condition|)
block|{
name|found
operator|=
literal|true
expr_stmt|;
break|break;
block|}
block|}
block|}
if|if
condition|(
operator|!
name|found
condition|)
continue|continue;
block|}
if|if
condition|(
name|department
operator|==
literal|null
operator|||
name|department
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
block|}
if|else if
condition|(
name|department
operator|.
name|contains
argument_list|(
literal|"Final"
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|location
operator|.
name|isExamEnabled
argument_list|(
name|Exam
operator|.
name|sExamTypeFinal
argument_list|)
condition|)
continue|continue;
block|}
if|else if
condition|(
name|department
operator|.
name|contains
argument_list|(
literal|"Midterm"
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|location
operator|.
name|isExamEnabled
argument_list|(
name|Exam
operator|.
name|sExamTypeMidterm
argument_list|)
condition|)
continue|continue;
block|}
if|else if
condition|(
operator|!
name|department
operator|.
name|contains
argument_list|(
literal|"Event"
argument_list|)
operator|&&
operator|!
name|department
operator|.
name|contains
argument_list|(
literal|"Managed"
argument_list|)
condition|)
block|{
name|boolean
name|found
init|=
literal|false
decl_stmt|;
for|for
control|(
name|RoomDept
name|rd
range|:
name|location
operator|.
name|getRoomDepts
argument_list|()
control|)
if|if
condition|(
name|department
operator|.
name|contains
argument_list|(
name|rd
operator|.
name|getDepartment
argument_list|()
operator|.
name|getDeptCode
argument_list|()
argument_list|)
condition|)
block|{
name|found
operator|=
literal|true
expr_stmt|;
break|break;
block|}
if|if
condition|(
operator|!
name|found
condition|)
continue|continue;
block|}
name|Coordinates
name|c
init|=
operator|new
name|Coordinates
argument_list|(
name|location
argument_list|)
decl_stmt|;
name|Double
name|distance
init|=
literal|null
decl_stmt|;
for|for
control|(
name|Coordinates
name|x
range|:
name|coord
control|)
block|{
name|double
name|d
init|=
name|c
operator|.
name|distance
argument_list|(
name|x
argument_list|)
decl_stmt|;
if|if
condition|(
name|distance
operator|==
literal|null
operator|||
name|distance
operator|>
name|d
condition|)
name|distance
operator|=
name|d
expr_stmt|;
block|}
if|if
condition|(
name|distance
operator|!=
literal|null
operator|&&
name|distance
operator|<=
name|allowedDistance
condition|)
block|{
name|ret
operator|.
name|add
argument_list|(
name|location
argument_list|)
expr_stmt|;
if|if
condition|(
name|distances
operator|!=
literal|null
condition|)
name|distances
operator|.
name|put
argument_list|(
name|location
operator|.
name|getUniqueId
argument_list|()
argument_list|,
name|distance
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
specifier|final
name|boolean
name|sortBySize
init|=
operator|(
name|size
operator|!=
literal|null
operator|&&
operator|!
name|size
operator|.
name|isEmpty
argument_list|()
operator|)
decl_stmt|;
name|Collections
operator|.
name|sort
argument_list|(
name|ret
argument_list|,
operator|new
name|Comparator
argument_list|<
name|Location
argument_list|>
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|int
name|compare
parameter_list|(
name|Location
name|l1
parameter_list|,
name|Location
name|l2
parameter_list|)
block|{
name|Double
name|d1
init|=
name|distances
operator|.
name|get
argument_list|(
name|l1
operator|.
name|getUniqueId
argument_list|()
argument_list|)
decl_stmt|;
name|Double
name|d2
init|=
name|distances
operator|.
name|get
argument_list|(
name|l2
operator|.
name|getUniqueId
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
name|d1
operator|==
literal|null
operator|&&
name|d2
operator|!=
literal|null
condition|)
return|return
operator|-
literal|1
return|;
if|if
condition|(
name|d1
operator|!=
literal|null
operator|&&
name|d2
operator|==
literal|null
condition|)
return|return
literal|1
return|;
if|if
condition|(
name|d1
operator|!=
literal|null
condition|)
block|{
name|int
name|cmp
init|=
operator|new
name|Long
argument_list|(
name|Math
operator|.
name|round
argument_list|(
name|d1
argument_list|)
argument_list|)
operator|.
name|compareTo
argument_list|(
name|Math
operator|.
name|round
argument_list|(
name|d2
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|cmp
operator|!=
literal|0
condition|)
return|return
name|cmp
return|;
block|}
if|if
condition|(
name|sortBySize
condition|)
block|{
name|int
name|cmp
init|=
operator|new
name|Integer
argument_list|(
name|l1
operator|.
name|getCapacity
argument_list|()
operator|!=
literal|null
condition|?
name|l1
operator|.
name|getCapacity
argument_list|()
else|:
name|Integer
operator|.
name|MAX_VALUE
argument_list|)
operator|.
name|compareTo
argument_list|(
name|l2
operator|.
name|getCapacity
argument_list|()
operator|!=
literal|null
condition|?
name|l2
operator|.
name|getCapacity
argument_list|()
else|:
name|Integer
operator|.
name|MAX_VALUE
argument_list|)
decl_stmt|;
if|if
condition|(
name|cmp
operator|!=
literal|0
condition|)
return|return
name|cmp
return|;
block|}
return|return
name|l1
operator|.
name|getLabel
argument_list|()
operator|.
name|compareTo
argument_list|(
name|l2
operator|.
name|getLabel
argument_list|()
argument_list|)
return|;
block|}
block|}
argument_list|)
expr_stmt|;
return|return
operator|(
name|limit
operator|<=
literal|0
operator|||
name|ret
operator|.
name|size
argument_list|()
operator|<
name|limit
condition|?
name|ret
else|:
name|ret
operator|.
name|subList
argument_list|(
literal|0
argument_list|,
name|limit
argument_list|)
operator|)
return|;
block|}
annotation|@
name|Override
specifier|public
name|void
name|suggestions
parameter_list|(
name|FilterRpcRequest
name|request
parameter_list|,
name|FilterRpcResponse
name|response
parameter_list|)
block|{
name|Map
argument_list|<
name|Long
argument_list|,
name|Double
argument_list|>
name|distances
init|=
operator|new
name|HashMap
argument_list|<
name|Long
argument_list|,
name|Double
argument_list|>
argument_list|()
decl_stmt|;
for|for
control|(
name|Location
name|location
range|:
name|locations
argument_list|(
name|request
operator|.
name|getSessionId
argument_list|()
argument_list|,
name|request
operator|.
name|getOptions
argument_list|()
argument_list|,
operator|new
name|Query
argument_list|(
name|request
operator|.
name|getText
argument_list|()
argument_list|)
argument_list|,
literal|20
argument_list|,
name|distances
argument_list|,
literal|null
argument_list|)
control|)
block|{
name|String
name|hint
init|=
name|location
operator|.
name|getRoomTypeLabel
argument_list|()
operator|+
literal|", "
operator|+
name|location
operator|.
name|getCapacity
argument_list|()
operator|+
literal|" seats"
decl_stmt|;
name|Double
name|dist
init|=
name|distances
operator|.
name|get
argument_list|(
name|location
operator|.
name|getUniqueId
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
name|dist
operator|!=
literal|null
condition|)
name|hint
operator|+=
literal|", "
operator|+
name|Math
operator|.
name|round
argument_list|(
name|dist
argument_list|)
operator|+
literal|" m"
expr_stmt|;
name|response
operator|.
name|addSuggestion
argument_list|(
name|location
operator|.
name|getLabel
argument_list|()
argument_list|,
name|location
operator|.
name|getLabel
argument_list|()
argument_list|,
literal|"("
operator|+
name|hint
operator|+
literal|")"
argument_list|)
expr_stmt|;
block|}
block|}
annotation|@
name|Override
specifier|public
name|void
name|enumarate
parameter_list|(
name|FilterRpcRequest
name|request
parameter_list|,
name|FilterRpcResponse
name|response
parameter_list|)
block|{
name|Map
argument_list|<
name|Long
argument_list|,
name|Double
argument_list|>
name|distances
init|=
operator|new
name|HashMap
argument_list|<
name|Long
argument_list|,
name|Double
argument_list|>
argument_list|()
decl_stmt|;
for|for
control|(
name|Location
name|location
range|:
name|locations
argument_list|(
name|request
operator|.
name|getSessionId
argument_list|()
argument_list|,
name|request
operator|.
name|getOptions
argument_list|()
argument_list|,
operator|new
name|Query
argument_list|(
name|request
operator|.
name|getText
argument_list|()
argument_list|)
argument_list|,
operator|-
literal|1
argument_list|,
name|distances
argument_list|,
literal|null
argument_list|)
control|)
block|{
name|Double
name|dist
init|=
name|distances
operator|.
name|get
argument_list|(
name|location
operator|.
name|getUniqueId
argument_list|()
argument_list|)
decl_stmt|;
name|String
name|hint
init|=
name|location
operator|.
name|getHtmlHint
argument_list|()
operator|.
name|replace
argument_list|(
literal|"\\'"
argument_list|,
literal|"'"
argument_list|)
decl_stmt|;
if|if
condition|(
name|dist
operator|!=
literal|null
condition|)
name|hint
operator|=
name|hint
operator|.
name|replace
argument_list|(
literal|"</table>"
argument_list|,
literal|"<tr><td>Distance:</td><td>"
operator|+
name|Math
operator|.
name|round
argument_list|(
name|dist
argument_list|)
operator|+
literal|" m</td></tr></table>"
argument_list|)
expr_stmt|;
name|response
operator|.
name|addResult
argument_list|(
operator|new
name|Entity
argument_list|(
name|location
operator|.
name|getUniqueId
argument_list|()
argument_list|,
name|location
operator|.
name|getDisplayName
argument_list|()
argument_list|,
name|location
operator|.
name|getLabel
argument_list|()
argument_list|,
literal|"type"
argument_list|,
name|location
operator|.
name|getRoomType
argument_list|()
operator|.
name|getLabel
argument_list|()
argument_list|,
literal|"capacity"
argument_list|,
name|location
operator|.
name|getCapacity
argument_list|()
operator|.
name|toString
argument_list|()
argument_list|,
literal|"distance"
argument_list|,
name|String
operator|.
name|valueOf
argument_list|(
name|dist
operator|==
literal|null
condition|?
literal|0l
else|:
name|Math
operator|.
name|round
argument_list|(
name|dist
argument_list|)
argument_list|)
argument_list|,
literal|"mouseOver"
argument_list|,
name|hint
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
specifier|public
name|DistanceMetric
name|getDistanceMetric
parameter_list|()
block|{
if|if
condition|(
name|iMetrics
operator|==
literal|null
condition|)
block|{
name|DataProperties
name|config
init|=
operator|new
name|DataProperties
argument_list|()
decl_stmt|;
name|config
operator|.
name|setProperty
argument_list|(
literal|"Distances.Ellipsoid"
argument_list|,
name|ApplicationProperties
operator|.
name|getProperty
argument_list|(
literal|"unitime.distance.ellipsoid"
argument_list|,
name|DistanceMetric
operator|.
name|Ellipsoid
operator|.
name|LEGACY
operator|.
name|name
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|iMetrics
operator|=
operator|new
name|DistanceMetric
argument_list|(
operator|new
name|DataProperties
argument_list|(
name|config
argument_list|)
argument_list|)
expr_stmt|;
block|}
return|return
name|iMetrics
return|;
block|}
specifier|public
class|class
name|Coordinates
block|{
name|Long
name|iId
decl_stmt|;
name|Double
name|iX
decl_stmt|,
name|iY
decl_stmt|;
specifier|public
name|Coordinates
parameter_list|(
name|Long
name|id
parameter_list|,
name|Double
name|x
parameter_list|,
name|Double
name|y
parameter_list|)
block|{
name|iId
operator|=
name|id
expr_stmt|;
name|iX
operator|=
name|x
expr_stmt|;
name|iY
operator|=
name|y
expr_stmt|;
block|}
specifier|public
name|Coordinates
parameter_list|(
name|Location
name|location
parameter_list|)
block|{
name|iId
operator|=
name|location
operator|.
name|getUniqueId
argument_list|()
expr_stmt|;
name|iX
operator|=
name|location
operator|.
name|getCoordinateX
argument_list|()
expr_stmt|;
name|iY
operator|=
name|location
operator|.
name|getCoordinateY
argument_list|()
expr_stmt|;
block|}
specifier|public
name|Long
name|id
parameter_list|()
block|{
return|return
name|iId
return|;
block|}
specifier|public
name|Double
name|x
parameter_list|()
block|{
return|return
name|iX
return|;
block|}
specifier|public
name|Double
name|y
parameter_list|()
block|{
return|return
name|iY
return|;
block|}
specifier|public
name|boolean
name|hasCoordinates
parameter_list|()
block|{
return|return
name|iX
operator|!=
literal|null
operator|&&
name|iY
operator|!=
literal|null
return|;
block|}
specifier|public
name|boolean
name|equals
parameter_list|(
name|Object
name|o
parameter_list|)
block|{
if|if
condition|(
name|o
operator|==
literal|null
operator|||
operator|!
operator|(
name|o
operator|instanceof
name|Coordinates
operator|)
condition|)
return|return
literal|false
return|;
name|Coordinates
name|c
init|=
operator|(
name|Coordinates
operator|)
name|o
decl_stmt|;
if|if
condition|(
operator|!
name|hasCoordinates
argument_list|()
condition|)
return|return
operator|!
name|c
operator|.
name|hasCoordinates
argument_list|()
return|;
if|else if
condition|(
operator|!
name|c
operator|.
name|hasCoordinates
argument_list|()
condition|)
return|return
literal|false
return|;
return|return
name|Math
operator|.
name|abs
argument_list|(
name|c
operator|.
name|x
argument_list|()
operator|-
name|x
argument_list|()
argument_list|)
operator|<
name|EPSILON
operator|&&
name|Math
operator|.
name|abs
argument_list|(
name|c
operator|.
name|y
argument_list|()
operator|-
name|y
argument_list|()
argument_list|)
operator|<
name|EPSILON
return|;
block|}
specifier|public
name|double
name|distance
parameter_list|(
name|Coordinates
name|c
parameter_list|)
block|{
return|return
operator|(
name|hasCoordinates
argument_list|()
operator|&&
name|c
operator|.
name|hasCoordinates
argument_list|()
condition|?
name|getDistanceMetric
argument_list|()
operator|.
name|getDistanceInMeters
argument_list|(
name|x
argument_list|()
argument_list|,
name|y
argument_list|()
argument_list|,
name|c
operator|.
name|x
argument_list|()
argument_list|,
name|c
operator|.
name|y
argument_list|()
argument_list|)
else|:
name|Double
operator|.
name|POSITIVE_INFINITY
operator|)
return|;
block|}
specifier|public
name|double
name|distance
parameter_list|(
name|Location
name|location
parameter_list|)
block|{
return|return
name|distance
argument_list|(
operator|new
name|Coordinates
argument_list|(
name|location
argument_list|)
argument_list|)
return|;
block|}
specifier|public
name|String
name|toString
parameter_list|()
block|{
return|return
operator|(
name|hasCoordinates
argument_list|()
condition|?
name|sCDF
operator|.
name|format
argument_list|(
name|iX
argument_list|)
operator|+
literal|","
operator|+
name|sCDF
operator|.
name|format
argument_list|(
name|iY
argument_list|)
else|:
literal|""
operator|)
return|;
block|}
specifier|public
name|int
name|hashCode
parameter_list|()
block|{
return|return
name|toString
argument_list|()
operator|.
name|hashCode
argument_list|()
return|;
block|}
block|}
specifier|public
class|class
name|LocationMatcher
implements|implements
name|TermMatcher
block|{
specifier|private
name|Location
name|iLocation
decl_stmt|;
name|LocationMatcher
parameter_list|(
name|Location
name|location
parameter_list|)
block|{
name|iLocation
operator|=
name|location
expr_stmt|;
block|}
specifier|public
name|Location
name|getLocation
parameter_list|()
block|{
return|return
name|iLocation
return|;
block|}
annotation|@
name|Override
specifier|public
name|boolean
name|match
parameter_list|(
name|String
name|attr
parameter_list|,
name|String
name|term
parameter_list|)
block|{
if|if
condition|(
name|attr
operator|==
literal|null
operator|||
name|attr
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
return|return
operator|(
name|has
argument_list|(
name|getLocation
argument_list|()
operator|.
name|getLabel
argument_list|()
argument_list|,
name|term
argument_list|)
operator|||
name|has
argument_list|(
name|getLocation
argument_list|()
operator|.
name|getDisplayName
argument_list|()
argument_list|,
name|term
argument_list|)
operator|||
name|getLocation
argument_list|()
operator|.
name|getLabel
argument_list|()
operator|.
name|toLowerCase
argument_list|()
operator|.
name|startsWith
argument_list|(
name|term
operator|.
name|toLowerCase
argument_list|()
argument_list|)
operator|||
operator|(
name|getLocation
argument_list|()
operator|instanceof
name|Room
operator|&&
operator|(
operator|(
name|Room
operator|)
name|getLocation
argument_list|()
operator|)
operator|.
name|getRoomNumber
argument_list|()
operator|.
name|toLowerCase
argument_list|()
operator|.
name|startsWith
argument_list|(
name|term
operator|.
name|toLowerCase
argument_list|()
argument_list|)
operator|)
operator|)
return|;
block|}
if|else if
condition|(
literal|"feature"
operator|.
name|equals
argument_list|(
name|attr
argument_list|)
condition|)
block|{
for|for
control|(
name|RoomFeature
name|rf
range|:
name|getLocation
argument_list|()
operator|.
name|getFeatures
argument_list|()
control|)
if|if
condition|(
name|rf
operator|instanceof
name|GlobalRoomFeature
operator|&&
operator|(
name|eq
argument_list|(
name|rf
operator|.
name|getAbbv
argument_list|()
argument_list|,
name|term
argument_list|)
operator|||
name|has
argument_list|(
name|rf
operator|.
name|getLabel
argument_list|()
argument_list|,
name|term
argument_list|)
operator|)
condition|)
return|return
literal|true
return|;
return|return
literal|false
return|;
block|}
if|else if
condition|(
literal|"group"
operator|.
name|equals
argument_list|(
name|attr
argument_list|)
condition|)
block|{
for|for
control|(
name|RoomGroup
name|rg
range|:
name|getLocation
argument_list|()
operator|.
name|getRoomGroups
argument_list|()
control|)
if|if
condition|(
name|rg
operator|.
name|isGlobal
argument_list|()
operator|&&
operator|(
name|eq
argument_list|(
name|rg
operator|.
name|getAbbv
argument_list|()
argument_list|,
name|term
argument_list|)
operator|||
name|has
argument_list|(
name|rg
operator|.
name|getName
argument_list|()
argument_list|,
name|term
argument_list|)
operator|)
condition|)
return|return
literal|true
return|;
return|return
literal|false
return|;
block|}
if|else if
condition|(
literal|"type"
operator|.
name|equals
argument_list|(
name|attr
argument_list|)
condition|)
block|{
return|return
name|eq
argument_list|(
name|getLocation
argument_list|()
operator|.
name|getRoomType
argument_list|()
operator|.
name|getReference
argument_list|()
argument_list|,
name|term
argument_list|)
operator|||
name|has
argument_list|(
name|getLocation
argument_list|()
operator|.
name|getRoomType
argument_list|()
operator|.
name|getLabel
argument_list|()
argument_list|,
name|term
argument_list|)
return|;
block|}
if|else if
condition|(
literal|"building"
operator|.
name|equals
argument_list|(
name|attr
argument_list|)
condition|)
block|{
if|if
condition|(
name|getLocation
argument_list|()
operator|instanceof
name|Room
condition|)
block|{
name|Building
name|building
init|=
operator|(
operator|(
name|Room
operator|)
name|getLocation
argument_list|()
operator|)
operator|.
name|getBuilding
argument_list|()
decl_stmt|;
return|return
name|eq
argument_list|(
name|building
operator|.
name|getAbbreviation
argument_list|()
argument_list|,
name|term
argument_list|)
operator|||
name|has
argument_list|(
name|building
operator|.
name|getName
argument_list|()
argument_list|,
name|term
argument_list|)
return|;
block|}
return|return
literal|false
return|;
block|}
if|else if
condition|(
literal|"size"
operator|.
name|equals
argument_list|(
name|attr
argument_list|)
condition|)
block|{
name|int
name|min
init|=
literal|0
decl_stmt|,
name|max
init|=
name|Integer
operator|.
name|MAX_VALUE
decl_stmt|;
name|Size
name|prefix
init|=
name|Size
operator|.
name|eq
decl_stmt|;
name|String
name|number
init|=
name|term
decl_stmt|;
if|if
condition|(
name|number
operator|.
name|startsWith
argument_list|(
literal|"<="
argument_list|)
condition|)
block|{
name|prefix
operator|=
name|Size
operator|.
name|le
expr_stmt|;
name|number
operator|=
name|number
operator|.
name|substring
argument_list|(
literal|2
argument_list|)
expr_stmt|;
block|}
if|else if
condition|(
name|number
operator|.
name|startsWith
argument_list|(
literal|">="
argument_list|)
condition|)
block|{
name|prefix
operator|=
name|Size
operator|.
name|ge
expr_stmt|;
name|number
operator|=
name|number
operator|.
name|substring
argument_list|(
literal|2
argument_list|)
expr_stmt|;
block|}
if|else if
condition|(
name|number
operator|.
name|startsWith
argument_list|(
literal|"<"
argument_list|)
condition|)
block|{
name|prefix
operator|=
name|Size
operator|.
name|lt
expr_stmt|;
name|number
operator|=
name|number
operator|.
name|substring
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|else if
condition|(
name|number
operator|.
name|startsWith
argument_list|(
literal|">"
argument_list|)
condition|)
block|{
name|prefix
operator|=
name|Size
operator|.
name|gt
expr_stmt|;
name|number
operator|=
name|number
operator|.
name|substring
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
if|else if
condition|(
name|number
operator|.
name|startsWith
argument_list|(
literal|"="
argument_list|)
condition|)
block|{
name|prefix
operator|=
name|Size
operator|.
name|eq
expr_stmt|;
name|number
operator|=
name|number
operator|.
name|substring
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
try|try
block|{
name|int
name|a
init|=
name|Integer
operator|.
name|parseInt
argument_list|(
name|number
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|prefix
condition|)
block|{
case|case
name|eq
case|:
name|min
operator|=
name|max
operator|=
name|a
expr_stmt|;
break|break;
comment|// = a
case|case
name|le
case|:
name|max
operator|=
name|a
expr_stmt|;
break|break;
comment|//<= a
case|case
name|ge
case|:
name|min
operator|=
name|a
expr_stmt|;
break|break;
comment|//>= a
case|case
name|lt
case|:
name|max
operator|=
name|a
operator|-
literal|1
expr_stmt|;
break|break;
comment|//< a
case|case
name|gt
case|:
name|min
operator|=
name|a
operator|+
literal|1
expr_stmt|;
break|break;
comment|//> a
block|}
block|}
catch|catch
parameter_list|(
name|NumberFormatException
name|e
parameter_list|)
block|{
block|}
if|if
condition|(
name|term
operator|.
name|contains
argument_list|(
literal|".."
argument_list|)
condition|)
block|{
try|try
block|{
name|String
name|a
init|=
name|term
operator|.
name|substring
argument_list|(
literal|0
argument_list|,
name|term
operator|.
name|indexOf
argument_list|(
literal|'.'
argument_list|)
argument_list|)
decl_stmt|;
name|String
name|b
init|=
name|term
operator|.
name|substring
argument_list|(
name|term
operator|.
name|indexOf
argument_list|(
literal|".."
argument_list|)
operator|+
literal|2
argument_list|)
decl_stmt|;
name|min
operator|=
name|Integer
operator|.
name|parseInt
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|max
operator|=
name|Integer
operator|.
name|parseInt
argument_list|(
name|b
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|NumberFormatException
name|e
parameter_list|)
block|{
block|}
block|}
return|return
name|min
operator|<=
name|getLocation
argument_list|()
operator|.
name|getCapacity
argument_list|()
operator|&&
name|getLocation
argument_list|()
operator|.
name|getCapacity
argument_list|()
operator|<=
name|max
return|;
block|}
else|else
block|{
return|return
literal|true
return|;
block|}
block|}
specifier|private
name|boolean
name|eq
parameter_list|(
name|String
name|name
parameter_list|,
name|String
name|term
parameter_list|)
block|{
if|if
condition|(
name|name
operator|==
literal|null
condition|)
return|return
literal|false
return|;
return|return
name|name
operator|.
name|equalsIgnoreCase
argument_list|(
name|term
argument_list|)
return|;
block|}
specifier|private
name|boolean
name|has
parameter_list|(
name|String
name|name
parameter_list|,
name|String
name|term
parameter_list|)
block|{
if|if
condition|(
name|name
operator|==
literal|null
condition|)
return|return
literal|false
return|;
if|if
condition|(
name|eq
argument_list|(
name|name
argument_list|,
name|term
argument_list|)
condition|)
return|return
literal|true
return|;
for|for
control|(
name|String
name|t
range|:
name|name
operator|.
name|split
argument_list|(
literal|" |,"
argument_list|)
control|)
if|if
condition|(
name|t
operator|.
name|equalsIgnoreCase
argument_list|(
name|term
argument_list|)
condition|)
return|return
literal|true
return|;
return|return
literal|false
return|;
block|}
block|}
block|}
end_class

end_unit

