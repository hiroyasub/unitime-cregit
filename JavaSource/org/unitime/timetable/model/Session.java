begin_unit|revision:1.0.0;language:Java;cregit-version:0.0.1
begin_comment
comment|/*  * Licensed to The Apereo Foundation under one or more contributor license  * agreements. See the NOTICE file distributed with this work for  * additional information regarding copyright ownership.  *  * The Apereo Foundation licenses this file to you under the Apache License,  * Version 2.0 (the "License"); you may not use this file except in  * compliance with the License. You may obtain a copy of the License at:  *  * http://www.apache.org/licenses/LICENSE-2.0  *  * Unless required by applicable law or agreed to in writing, software  * distributed under the License is distributed on an "AS IS" BASIS,  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  *  * See the License for the specific language governing permissions and  * limitations under the License.  *  */
end_comment

begin_package
package|package
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
package|;
end_package

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|Serializable
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Calendar
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Collection
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Date
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Iterator
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Locale
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|TreeSet
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|servlet
operator|.
name|http
operator|.
name|HttpServletRequest
import|;
end_import

begin_import
import|import
name|org
operator|.
name|hibernate
operator|.
name|HibernateException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|hibernate
operator|.
name|SessionFactory
import|;
end_import

begin_import
import|import
name|org
operator|.
name|hibernate
operator|.
name|Transaction
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|commons
operator|.
name|Debug
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|commons
operator|.
name|hibernate
operator|.
name|util
operator|.
name|HibernateUtil
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|defaults
operator|.
name|ApplicationProperty
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|interfaces
operator|.
name|AcademicSessionLookup
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|base
operator|.
name|BaseSession
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|dao
operator|.
name|ExamDAO
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|dao
operator|.
name|InstructionalOfferingDAO
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|model
operator|.
name|dao
operator|.
name|SessionDAO
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|onlinesectioning
operator|.
name|OnlineSectioningLog
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|onlinesectioning
operator|.
name|OnlineSectioningServer
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|onlinesectioning
operator|.
name|updates
operator|.
name|ReloadOfferingAction
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|security
operator|.
name|Qualifiable
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|security
operator|.
name|UserContext
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|solver
operator|.
name|service
operator|.
name|SolverServerService
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|spring
operator|.
name|SpringApplicationContextHolder
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|util
operator|.
name|DateUtils
import|;
end_import

begin_import
import|import
name|org
operator|.
name|unitime
operator|.
name|timetable
operator|.
name|util
operator|.
name|ReferenceList
import|;
end_import

begin_comment
comment|/**  * @hibernate.class table="SESSIONS" schema = "TIMETABLE"  *  * @author Tomas Muller, Stephanie Schluttenhofer, Zuzana Mullerova  */
end_comment

begin_class
specifier|public
class|class
name|Session
extends|extends
name|BaseSession
implements|implements
name|Comparable
argument_list|<
name|Session
argument_list|>
implements|,
name|Qualifiable
block|{
specifier|public
specifier|static
specifier|final
name|int
name|sHolidayTypeNone
init|=
literal|0
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|int
name|sHolidayTypeHoliday
init|=
literal|1
decl_stmt|;
specifier|public
specifier|static
specifier|final
name|int
name|sHolidayTypeBreak
init|=
literal|2
decl_stmt|;
specifier|public
specifier|static
name|String
index|[]
name|sHolidayTypeNames
init|=
operator|new
name|String
index|[]
block|{
literal|"No Holiday"
block|,
literal|"Holiday"
block|,
literal|"(Spring/October/Thanksgiving) Break"
block|}
decl_stmt|;
specifier|public
specifier|static
name|String
index|[]
name|sHolidayTypeColors
init|=
operator|new
name|String
index|[]
block|{
literal|"rgb(240,240,240)"
block|,
literal|"rgb(200,30,20)"
block|,
literal|"rgb(240,50,240)"
block|}
decl_stmt|;
specifier|private
specifier|static
specifier|final
name|long
name|serialVersionUID
init|=
literal|3691040980400813366L
decl_stmt|;
comment|/* 	 * @return all sessions 	 */
specifier|public
specifier|static
name|TreeSet
argument_list|<
name|Session
argument_list|>
name|getAllSessions
parameter_list|()
throws|throws
name|HibernateException
block|{
name|TreeSet
argument_list|<
name|Session
argument_list|>
name|ret
init|=
operator|new
name|TreeSet
argument_list|<
name|Session
argument_list|>
argument_list|()
decl_stmt|;
for|for
control|(
name|Session
name|session
range|:
name|SessionDAO
operator|.
name|getInstance
argument_list|()
operator|.
name|findAll
argument_list|()
control|)
block|{
if|if
condition|(
name|session
operator|.
name|getStatusType
argument_list|()
operator|!=
literal|null
operator|&&
operator|!
name|session
operator|.
name|getStatusType
argument_list|()
operator|.
name|isTestSession
argument_list|()
condition|)
name|ret
operator|.
name|add
argument_list|(
name|session
argument_list|)
expr_stmt|;
block|}
return|return
name|ret
return|;
block|}
comment|/** 	 * @param id 	 * @return 	 * @throws HibernateException 	 */
specifier|public
specifier|static
name|Session
name|getSessionById
parameter_list|(
name|Long
name|id
parameter_list|)
throws|throws
name|HibernateException
block|{
return|return
operator|(
operator|new
name|SessionDAO
argument_list|()
operator|)
operator|.
name|get
argument_list|(
name|id
argument_list|)
return|;
block|}
specifier|private
specifier|static
name|void
name|deleteObjects
parameter_list|(
name|org
operator|.
name|hibernate
operator|.
name|Session
name|hibSession
parameter_list|,
name|String
name|objectName
parameter_list|,
name|Iterator
name|idIterator
parameter_list|)
block|{
name|StringBuffer
name|ids
init|=
operator|new
name|StringBuffer
argument_list|()
decl_stmt|;
name|int
name|idx
init|=
literal|0
decl_stmt|;
while|while
condition|(
name|idIterator
operator|.
name|hasNext
argument_list|()
condition|)
block|{
name|ids
operator|.
name|append
argument_list|(
name|idIterator
operator|.
name|next
argument_list|()
argument_list|)
expr_stmt|;
name|idx
operator|++
expr_stmt|;
if|if
condition|(
name|idx
operator|==
literal|100
condition|)
block|{
name|hibSession
operator|.
name|createQuery
argument_list|(
literal|"delete "
operator|+
name|objectName
operator|+
literal|" as x where x.uniqueId in ("
operator|+
name|ids
operator|+
literal|")"
argument_list|)
operator|.
name|executeUpdate
argument_list|()
expr_stmt|;
name|ids
operator|=
operator|new
name|StringBuffer
argument_list|()
expr_stmt|;
name|idx
operator|=
literal|0
expr_stmt|;
block|}
if|else if
condition|(
name|idIterator
operator|.
name|hasNext
argument_list|()
condition|)
block|{
name|ids
operator|.
name|append
argument_list|(
literal|","
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|idx
operator|>
literal|0
condition|)
name|hibSession
operator|.
name|createQuery
argument_list|(
literal|"delete "
operator|+
name|objectName
operator|+
literal|" as x where x.uniqueId in ("
operator|+
name|ids
operator|+
literal|")"
argument_list|)
operator|.
name|executeUpdate
argument_list|()
expr_stmt|;
block|}
comment|/** 	 * @param id 	 * @throws HibernateException 	 */
annotation|@
name|SuppressWarnings
argument_list|(
literal|"unchecked"
argument_list|)
specifier|public
specifier|static
name|void
name|deleteSessionById
parameter_list|(
name|Long
name|id
parameter_list|)
throws|throws
name|HibernateException
block|{
name|org
operator|.
name|hibernate
operator|.
name|Session
name|hibSession
init|=
operator|new
name|SessionDAO
argument_list|()
operator|.
name|getSession
argument_list|()
decl_stmt|;
name|Transaction
name|tx
init|=
literal|null
decl_stmt|;
try|try
block|{
name|tx
operator|=
name|hibSession
operator|.
name|beginTransaction
argument_list|()
expr_stmt|;
for|for
control|(
name|Location
name|loc
range|:
operator|(
name|List
argument_list|<
name|Location
argument_list|>
operator|)
name|hibSession
operator|.
name|createQuery
argument_list|(
literal|"from Location where session.uniqueId = :sessionId"
argument_list|)
operator|.
name|setLong
argument_list|(
literal|"sessionId"
argument_list|,
name|id
argument_list|)
operator|.
name|list
argument_list|()
control|)
block|{
name|loc
operator|.
name|getFeatures
argument_list|()
operator|.
name|clear
argument_list|()
expr_stmt|;
name|loc
operator|.
name|getRoomGroups
argument_list|()
operator|.
name|clear
argument_list|()
expr_stmt|;
name|hibSession
operator|.
name|update
argument_list|(
name|loc
argument_list|)
expr_stmt|;
block|}
comment|/*             for (Iterator i=hibSession.createQuery("from Exam where session.uniqueId=:sessionId").setLong("sessionId", id).iterate();i.hasNext();) {                 Exam x = (Exam)i.next();                 for (Iterator j=x.getConflicts().iterator();j.hasNext();) {                     ExamConflict conf = (ExamConflict)j.next();                     hibSession.delete(conf);                     j.remove();                 }                 hibSession.update(x);             }             */
name|hibSession
operator|.
name|flush
argument_list|()
expr_stmt|;
name|hibSession
operator|.
name|createQuery
argument_list|(
literal|"delete DistributionPref p where p.owner in (select s from Session s where s.uniqueId=:sessionId)"
argument_list|)
operator|.
name|setLong
argument_list|(
literal|"sessionId"
argument_list|,
name|id
argument_list|)
operator|.
name|executeUpdate
argument_list|()
expr_stmt|;
name|hibSession
operator|.
name|createQuery
argument_list|(
literal|"delete InstructionalOffering o where o.session.uniqueId=:sessionId"
argument_list|)
operator|.
name|setLong
argument_list|(
literal|"sessionId"
argument_list|,
name|id
argument_list|)
operator|.
name|executeUpdate
argument_list|()
expr_stmt|;
name|hibSession
operator|.
name|createQuery
argument_list|(
literal|"delete Department d where d.session.uniqueId=:sessionId"
argument_list|)
operator|.
name|setLong
argument_list|(
literal|"sessionId"
argument_list|,
name|id
argument_list|)
operator|.
name|executeUpdate
argument_list|()
expr_stmt|;
name|hibSession
operator|.
name|createQuery
argument_list|(
literal|"delete Session s where s.uniqueId=:sessionId"
argument_list|)
operator|.
name|setLong
argument_list|(
literal|"sessionId"
argument_list|,
name|id
argument_list|)
operator|.
name|executeUpdate
argument_list|()
expr_stmt|;
name|String
index|[]
name|a
init|=
block|{
literal|"DistributionPref"
block|,
literal|"RoomPref"
block|,
literal|"RoomGroupPref"
block|,
literal|"RoomFeaturePref"
block|,
literal|"BuildingPref"
block|,
literal|"TimePref"
block|,
literal|"DatePatternPref"
block|,
literal|"ExamPeriodPref"
block|}
decl_stmt|;
for|for
control|(
name|String
name|str
range|:
name|a
control|)
block|{
name|hibSession
operator|.
name|createQuery
argument_list|(
literal|"delete "
operator|+
name|str
operator|+
literal|" p where owner not in (from PreferenceGroup)"
argument_list|)
operator|.
name|executeUpdate
argument_list|()
expr_stmt|;
block|}
name|deleteObjects
argument_list|(
name|hibSession
argument_list|,
literal|"ExamConflict"
argument_list|,
name|hibSession
operator|.
name|createQuery
argument_list|(
literal|"select x.uniqueId from ExamConflict x where x.exams is empty"
argument_list|)
operator|.
name|iterate
argument_list|()
argument_list|)
expr_stmt|;
name|tx
operator|.
name|commit
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|HibernateException
name|e
parameter_list|)
block|{
try|try
block|{
if|if
condition|(
name|tx
operator|!=
literal|null
operator|&&
name|tx
operator|.
name|isActive
argument_list|()
condition|)
name|tx
operator|.
name|rollback
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e1
parameter_list|)
block|{
block|}
throw|throw
name|e
throw|;
block|}
name|HibernateUtil
operator|.
name|clearCache
argument_list|()
expr_stmt|;
block|}
specifier|public
name|void
name|saveOrUpdate
parameter_list|()
throws|throws
name|HibernateException
block|{
operator|(
operator|new
name|SessionDAO
argument_list|()
operator|)
operator|.
name|saveOrUpdate
argument_list|(
name|this
argument_list|)
expr_stmt|;
block|}
specifier|public
name|String
name|getAcademicYearTerm
parameter_list|()
block|{
return|return
operator|(
name|getAcademicYear
argument_list|()
operator|+
name|getAcademicTerm
argument_list|()
operator|)
return|;
block|}
comment|/** 	 * @return Returns the term. 	 */
specifier|public
name|String
name|getTermLabel
parameter_list|()
block|{
return|return
name|this
operator|.
name|getAcademicTerm
argument_list|()
return|;
block|}
comment|/** 	 * @return Returns the label. 	 */
specifier|public
name|String
name|getLabel
parameter_list|()
block|{
return|return
name|getAcademicTerm
argument_list|()
operator|+
literal|" "
operator|+
name|getAcademicYear
argument_list|()
operator|+
literal|" ("
operator|+
name|getAcademicInitiative
argument_list|()
operator|+
literal|")"
return|;
block|}
specifier|public
name|String
name|getReference
parameter_list|()
block|{
return|return
name|getAcademicTerm
argument_list|()
operator|+
name|getAcademicYear
argument_list|()
operator|+
name|getAcademicInitiative
argument_list|()
return|;
block|}
specifier|public
name|String
name|toString
parameter_list|()
block|{
return|return
name|this
operator|.
name|getLabel
argument_list|()
return|;
block|}
comment|/** 	 * @return Returns the year the session begins. 	 */
specifier|public
name|int
name|getSessionStartYear
parameter_list|()
block|{
if|if
condition|(
name|getSessionBeginDateTime
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|Calendar
name|c
init|=
name|Calendar
operator|.
name|getInstance
argument_list|(
name|Locale
operator|.
name|US
argument_list|)
decl_stmt|;
name|c
operator|.
name|setTime
argument_list|(
name|getSessionBeginDateTime
argument_list|()
argument_list|)
expr_stmt|;
return|return
name|c
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|YEAR
argument_list|)
return|;
block|}
return|return
name|Integer
operator|.
name|parseInt
argument_list|(
name|this
operator|.
name|getAcademicYear
argument_list|()
argument_list|)
return|;
block|}
comment|/** 	 * @return Returns the year. 	 */
specifier|public
specifier|static
name|int
name|getYear
parameter_list|(
name|String
name|acadYrTerm
parameter_list|)
block|{
return|return
name|Integer
operator|.
name|parseInt
argument_list|(
name|acadYrTerm
operator|.
name|substring
argument_list|(
literal|0
argument_list|,
literal|4
argument_list|)
argument_list|)
return|;
block|}
comment|/** 	 * @param bldgUniqueId 	 * @return 	 */
specifier|public
name|Building
name|building
parameter_list|(
name|String
name|bldgUniqueId
parameter_list|)
block|{
comment|// TODO make faster
for|for
control|(
name|Building
name|bldg
range|:
name|this
operator|.
name|getBuildings
argument_list|()
control|)
block|{
if|if
condition|(
name|bldg
operator|.
name|getExternalUniqueId
argument_list|()
operator|.
name|equals
argument_list|(
name|bldgUniqueId
argument_list|)
condition|)
block|{
return|return
name|bldg
return|;
block|}
block|}
return|return
literal|null
return|;
block|}
specifier|public
name|String
name|academicInitiativeDisplayString
parameter_list|()
block|{
return|return
name|this
operator|.
name|getAcademicInitiative
argument_list|()
return|;
block|}
specifier|public
name|String
name|statusDisplayString
parameter_list|()
block|{
return|return
name|getStatusType
argument_list|()
operator|.
name|getLabel
argument_list|()
return|;
block|}
comment|/** 	 * @return Returns the sessionStatusMap. 	 */
specifier|public
specifier|static
name|ReferenceList
name|getSessionStatusList
parameter_list|(
name|boolean
name|includeTestSessions
parameter_list|)
block|{
name|ReferenceList
name|ref
init|=
operator|new
name|ReferenceList
argument_list|()
decl_stmt|;
name|ref
operator|.
name|addAll
argument_list|(
name|DepartmentStatusType
operator|.
name|findAllForSession
argument_list|(
name|includeTestSessions
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|ref
return|;
block|}
specifier|public
specifier|static
name|Session
name|getSessionUsingInitiativeYearTerm
parameter_list|(
name|String
name|academicInitiative
parameter_list|,
name|String
name|academicYear
parameter_list|,
name|String
name|academicTerm
parameter_list|)
block|{
return|return
operator|(
name|getSessionUsingInitiativeYearTerm
argument_list|(
name|academicInitiative
argument_list|,
name|academicYear
argument_list|,
name|academicTerm
argument_list|,
name|SessionDAO
operator|.
name|getInstance
argument_list|()
operator|.
name|getSession
argument_list|()
argument_list|)
operator|)
return|;
block|}
specifier|public
specifier|static
name|Session
name|getSessionUsingInitiativeYearTerm
parameter_list|(
name|String
name|academicInitiative
parameter_list|,
name|String
name|academicYear
parameter_list|,
name|String
name|academicTerm
parameter_list|,
name|org
operator|.
name|hibernate
operator|.
name|Session
name|hibSession
parameter_list|)
block|{
return|return
operator|(
name|Session
operator|)
name|hibSession
operator|.
name|createQuery
argument_list|(
literal|"from Session s where s.academicInitiative = :academicInitiative and s.academicYear = :academicYear and s.academicTerm = :academicTerm"
argument_list|)
operator|.
name|setString
argument_list|(
literal|"academicInitiative"
argument_list|,
name|academicInitiative
argument_list|)
operator|.
name|setString
argument_list|(
literal|"academicYear"
argument_list|,
name|academicYear
argument_list|)
operator|.
name|setString
argument_list|(
literal|"academicTerm"
argument_list|,
name|academicTerm
argument_list|)
operator|.
name|setCacheable
argument_list|(
literal|true
argument_list|)
operator|.
name|uniqueResult
argument_list|()
return|;
block|}
specifier|public
specifier|static
name|Session
name|getSessionUsingCampusYearTerm
parameter_list|(
name|String
name|campus
parameter_list|,
name|String
name|year
parameter_list|,
name|String
name|term
parameter_list|,
name|org
operator|.
name|hibernate
operator|.
name|Session
name|hibSession
parameter_list|)
block|{
name|String
name|className
init|=
name|ApplicationProperty
operator|.
name|AcademicSessionLookupImplementation
operator|.
name|value
argument_list|()
decl_stmt|;
name|AcademicSessionLookup
name|academicSessionLookup
init|=
literal|null
decl_stmt|;
try|try
block|{
name|academicSessionLookup
operator|=
operator|(
name|AcademicSessionLookup
operator|)
name|Class
operator|.
name|forName
argument_list|(
name|className
argument_list|)
operator|.
name|getDeclaredConstructor
argument_list|()
operator|.
name|newInstance
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
return|return
name|getSessionUsingInitiativeYearTerm
argument_list|(
name|campus
argument_list|,
name|year
argument_list|,
name|term
argument_list|,
name|hibSession
argument_list|)
return|;
block|}
return|return
name|academicSessionLookup
operator|.
name|findAcademicSession
argument_list|(
name|campus
argument_list|,
name|year
argument_list|,
name|term
argument_list|,
name|hibSession
argument_list|)
return|;
block|}
specifier|public
name|Session
name|getLastLikeSession
parameter_list|()
block|{
name|String
name|lastYr
init|=
name|Integer
operator|.
name|valueOf
argument_list|(
name|this
operator|.
name|getSessionStartYear
argument_list|()
operator|-
literal|1
argument_list|)
operator|.
name|toString
argument_list|()
decl_stmt|;
return|return
name|getSessionUsingInitiativeYearTerm
argument_list|(
name|this
operator|.
name|getAcademicInitiative
argument_list|()
argument_list|,
name|lastYr
argument_list|,
name|getAcademicTerm
argument_list|()
argument_list|)
return|;
block|}
specifier|public
name|Session
name|getNextLikeSession
parameter_list|()
block|{
name|String
name|nextYr
init|=
name|Integer
operator|.
name|valueOf
argument_list|(
name|this
operator|.
name|getSessionStartYear
argument_list|()
operator|+
literal|1
argument_list|)
operator|.
name|toString
argument_list|()
decl_stmt|;
return|return
name|getSessionUsingInitiativeYearTerm
argument_list|(
name|this
operator|.
name|getAcademicInitiative
argument_list|()
argument_list|,
name|nextYr
argument_list|,
name|getAcademicTerm
argument_list|()
argument_list|)
return|;
block|}
specifier|public
name|String
name|loadInstrAndCrsOffering
parameter_list|()
throws|throws
name|Exception
block|{
return|return
operator|(
literal|"done"
operator|)
return|;
block|}
specifier|public
name|Long
name|getSessionId
parameter_list|()
block|{
return|return
operator|(
name|this
operator|.
name|getUniqueId
argument_list|()
operator|)
return|;
block|}
specifier|public
name|void
name|setSessionId
parameter_list|(
name|Long
name|sessionId
parameter_list|)
block|{
name|this
operator|.
name|setUniqueId
argument_list|(
name|sessionId
argument_list|)
expr_stmt|;
block|}
specifier|public
name|String
name|htmlLabel
parameter_list|()
block|{
return|return
operator|(
name|this
operator|.
name|getLabel
argument_list|()
operator|)
return|;
block|}
specifier|public
name|Date
name|earliestSessionRelatedDate
parameter_list|()
block|{
return|return
operator|(
name|getEventBeginDate
argument_list|()
operator|!=
literal|null
operator|&&
name|getEventBeginDate
argument_list|()
operator|.
name|before
argument_list|(
name|getSessionBeginDateTime
argument_list|()
argument_list|)
condition|?
name|getEventBeginDate
argument_list|()
else|:
name|getSessionBeginDateTime
argument_list|()
operator|)
return|;
block|}
specifier|public
name|Date
name|latestSessionRelatedDate
parameter_list|()
block|{
return|return
operator|(
name|getEventEndDate
argument_list|()
operator|!=
literal|null
operator|&&
name|getEventEndDate
argument_list|()
operator|.
name|after
argument_list|(
name|getSessionEndDateTime
argument_list|()
argument_list|)
condition|?
name|getEventEndDate
argument_list|()
else|:
name|getSessionEndDateTime
argument_list|()
operator|)
return|;
block|}
specifier|public
name|int
name|getStartMonth
parameter_list|()
block|{
return|return
name|DateUtils
operator|.
name|getStartMonth
argument_list|(
name|earliestSessionRelatedDate
argument_list|()
argument_list|,
name|getSessionStartYear
argument_list|()
argument_list|,
name|ApplicationProperty
operator|.
name|SessionNrExcessDays
operator|.
name|intValue
argument_list|()
argument_list|)
return|;
block|}
specifier|public
name|int
name|getEndMonth
parameter_list|()
block|{
return|return
name|DateUtils
operator|.
name|getEndMonth
argument_list|(
name|latestSessionRelatedDate
argument_list|()
argument_list|,
name|getSessionStartYear
argument_list|()
argument_list|,
name|ApplicationProperty
operator|.
name|SessionNrExcessDays
operator|.
name|intValue
argument_list|()
argument_list|)
return|;
block|}
specifier|public
name|int
name|getPatternStartMonth
parameter_list|()
block|{
return|return
name|getStartMonth
argument_list|()
operator|-
name|ApplicationProperty
operator|.
name|DatePatternNrExessMonth
operator|.
name|intValue
argument_list|()
return|;
block|}
specifier|public
name|int
name|getPatternEndMonth
parameter_list|()
block|{
return|return
name|getEndMonth
argument_list|()
operator|+
name|ApplicationProperty
operator|.
name|DatePatternNrExessMonth
operator|.
name|intValue
argument_list|()
return|;
block|}
specifier|public
name|int
name|getDayOfYear
parameter_list|(
name|int
name|day
parameter_list|,
name|int
name|month
parameter_list|)
block|{
return|return
name|DateUtils
operator|.
name|getDayOfYear
argument_list|(
name|day
argument_list|,
name|month
argument_list|,
name|getSessionStartYear
argument_list|()
argument_list|)
return|;
block|}
specifier|public
name|int
name|getHoliday
parameter_list|(
name|int
name|day
parameter_list|,
name|int
name|month
parameter_list|)
block|{
return|return
name|getHoliday
argument_list|(
name|day
argument_list|,
name|month
argument_list|,
name|getSessionStartYear
argument_list|()
argument_list|,
name|getStartMonth
argument_list|()
argument_list|,
name|getHolidays
argument_list|()
argument_list|)
return|;
block|}
specifier|public
specifier|static
name|int
name|getHoliday
parameter_list|(
name|int
name|day
parameter_list|,
name|int
name|month
parameter_list|,
name|int
name|year
parameter_list|,
name|int
name|startMonth
parameter_list|,
name|String
name|holidays
parameter_list|)
block|{
try|try
block|{
if|if
condition|(
name|holidays
operator|==
literal|null
condition|)
return|return
name|sHolidayTypeNone
return|;
name|int
name|idx
init|=
name|DateUtils
operator|.
name|getDayOfYear
argument_list|(
name|day
argument_list|,
name|month
argument_list|,
name|year
argument_list|)
operator|-
name|DateUtils
operator|.
name|getDayOfYear
argument_list|(
literal|1
argument_list|,
name|startMonth
argument_list|,
name|year
argument_list|)
decl_stmt|;
if|if
condition|(
name|idx
operator|<
literal|0
operator|||
name|idx
operator|>=
name|holidays
operator|.
name|length
argument_list|()
condition|)
return|return
name|sHolidayTypeNone
return|;
return|return
operator|(
name|int
operator|)
operator|(
name|holidays
operator|.
name|charAt
argument_list|(
name|idx
argument_list|)
operator|-
literal|'0'
operator|)
return|;
block|}
catch|catch
parameter_list|(
name|IndexOutOfBoundsException
name|e
parameter_list|)
block|{
return|return
name|sHolidayTypeNone
return|;
block|}
block|}
specifier|public
name|String
name|getHolidaysHtml
parameter_list|()
block|{
return|return
name|getHolidaysHtml
argument_list|(
literal|true
argument_list|)
return|;
block|}
specifier|public
name|String
name|getHolidaysHtml
parameter_list|(
name|boolean
name|editable
parameter_list|)
block|{
return|return
name|getHolidaysHtml
argument_list|(
name|getSessionBeginDateTime
argument_list|()
argument_list|,
name|getSessionEndDateTime
argument_list|()
argument_list|,
name|getClassesEndDateTime
argument_list|()
argument_list|,
name|getExamBeginDate
argument_list|()
argument_list|,
name|getEventBeginDate
argument_list|()
argument_list|,
name|getEventEndDate
argument_list|()
argument_list|,
name|getSessionStartYear
argument_list|()
argument_list|,
name|getHolidays
argument_list|()
argument_list|,
name|editable
argument_list|,
name|EventDateMapping
operator|.
name|getMapping
argument_list|(
name|getUniqueId
argument_list|()
argument_list|)
argument_list|)
return|;
block|}
specifier|public
name|Date
name|getDate
parameter_list|(
name|int
name|index
parameter_list|)
block|{
name|Calendar
name|sessionBeginDate
init|=
name|Calendar
operator|.
name|getInstance
argument_list|(
name|Locale
operator|.
name|US
argument_list|)
decl_stmt|;
name|sessionBeginDate
operator|.
name|setTime
argument_list|(
name|getSessionBeginDateTime
argument_list|()
argument_list|)
expr_stmt|;
name|sessionBeginDate
operator|.
name|add
argument_list|(
name|Calendar
operator|.
name|DAY_OF_YEAR
argument_list|,
name|index
argument_list|)
expr_stmt|;
return|return
name|sessionBeginDate
operator|.
name|getTime
argument_list|()
return|;
block|}
specifier|public
specifier|static
name|String
name|getHolidaysHtml
parameter_list|(
name|Date
name|sessionBeginTime
parameter_list|,
name|Date
name|sessionEndTime
parameter_list|,
name|Date
name|classesEndTime
parameter_list|,
name|Date
name|examBeginTime
parameter_list|,
name|Date
name|eventBeginTime
parameter_list|,
name|Date
name|eventEndTime
parameter_list|,
name|int
name|acadYear
parameter_list|,
name|String
name|holidays
parameter_list|,
name|boolean
name|editable
parameter_list|,
name|EventDateMapping
operator|.
name|Class2EventDateMap
name|class2eventDateMap
parameter_list|)
block|{
name|StringBuffer
name|prefTable
init|=
operator|new
name|StringBuffer
argument_list|()
decl_stmt|;
name|StringBuffer
name|prefNames
init|=
operator|new
name|StringBuffer
argument_list|()
decl_stmt|;
name|StringBuffer
name|prefColors
init|=
operator|new
name|StringBuffer
argument_list|()
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|sHolidayTypeNames
operator|.
name|length
condition|;
name|i
operator|++
control|)
block|{
name|prefTable
operator|.
name|append
argument_list|(
operator|(
name|i
operator|==
literal|0
condition|?
literal|""
else|:
literal|","
operator|)
operator|+
literal|"'"
operator|+
name|i
operator|+
literal|"'"
argument_list|)
expr_stmt|;
name|prefNames
operator|.
name|append
argument_list|(
operator|(
name|i
operator|==
literal|0
condition|?
literal|""
else|:
literal|","
operator|)
operator|+
literal|"'"
operator|+
name|sHolidayTypeNames
index|[
name|i
index|]
operator|+
literal|"'"
argument_list|)
expr_stmt|;
name|prefColors
operator|.
name|append
argument_list|(
operator|(
name|i
operator|==
literal|0
condition|?
literal|""
else|:
literal|","
operator|)
operator|+
literal|"'"
operator|+
name|sHolidayTypeColors
index|[
name|i
index|]
operator|+
literal|"'"
argument_list|)
expr_stmt|;
block|}
name|StringBuffer
name|holidayArray
init|=
operator|new
name|StringBuffer
argument_list|()
decl_stmt|;
name|StringBuffer
name|borderArray
init|=
operator|new
name|StringBuffer
argument_list|()
decl_stmt|;
name|StringBuffer
name|colorArray
init|=
operator|new
name|StringBuffer
argument_list|()
decl_stmt|;
name|Calendar
name|sessionBeginDate
init|=
name|Calendar
operator|.
name|getInstance
argument_list|(
name|Locale
operator|.
name|US
argument_list|)
decl_stmt|;
name|sessionBeginDate
operator|.
name|setTime
argument_list|(
name|sessionBeginTime
argument_list|)
expr_stmt|;
name|Calendar
name|sessionEndDate
init|=
name|Calendar
operator|.
name|getInstance
argument_list|(
name|Locale
operator|.
name|US
argument_list|)
decl_stmt|;
name|sessionEndDate
operator|.
name|setTime
argument_list|(
name|sessionEndTime
argument_list|)
expr_stmt|;
name|Calendar
name|classesEndDate
init|=
name|Calendar
operator|.
name|getInstance
argument_list|(
name|Locale
operator|.
name|US
argument_list|)
decl_stmt|;
name|classesEndDate
operator|.
name|setTime
argument_list|(
name|classesEndTime
argument_list|)
expr_stmt|;
name|Calendar
name|examBeginDate
init|=
name|Calendar
operator|.
name|getInstance
argument_list|(
name|Locale
operator|.
name|US
argument_list|)
decl_stmt|;
if|if
condition|(
name|examBeginTime
operator|!=
literal|null
condition|)
name|examBeginDate
operator|.
name|setTime
argument_list|(
name|examBeginTime
argument_list|)
expr_stmt|;
name|Calendar
name|eventBeginDate
init|=
name|Calendar
operator|.
name|getInstance
argument_list|(
name|Locale
operator|.
name|US
argument_list|)
decl_stmt|;
if|if
condition|(
name|eventBeginTime
operator|!=
literal|null
condition|)
name|eventBeginDate
operator|.
name|setTime
argument_list|(
name|eventBeginTime
argument_list|)
expr_stmt|;
name|Calendar
name|eventEndDate
init|=
name|Calendar
operator|.
name|getInstance
argument_list|(
name|Locale
operator|.
name|US
argument_list|)
decl_stmt|;
if|if
condition|(
name|eventEndTime
operator|!=
literal|null
condition|)
name|eventEndDate
operator|.
name|setTime
argument_list|(
name|eventEndTime
argument_list|)
expr_stmt|;
name|int
name|startMonth
init|=
name|DateUtils
operator|.
name|getStartMonth
argument_list|(
name|eventBeginTime
operator|!=
literal|null
operator|&&
name|eventBeginTime
operator|.
name|before
argument_list|(
name|sessionBeginTime
argument_list|)
condition|?
name|eventBeginTime
else|:
name|sessionBeginTime
argument_list|,
name|acadYear
argument_list|,
name|ApplicationProperty
operator|.
name|SessionNrExcessDays
operator|.
name|intValue
argument_list|()
argument_list|)
decl_stmt|;
name|int
name|endMonth
init|=
name|DateUtils
operator|.
name|getEndMonth
argument_list|(
name|eventEndTime
operator|!=
literal|null
operator|&&
name|eventEndTime
operator|.
name|after
argument_list|(
name|sessionEndTime
argument_list|)
condition|?
name|eventEndTime
else|:
name|sessionEndTime
argument_list|,
name|acadYear
argument_list|,
name|ApplicationProperty
operator|.
name|SessionNrExcessDays
operator|.
name|intValue
argument_list|()
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|m
init|=
name|startMonth
init|;
name|m
operator|<=
name|endMonth
condition|;
name|m
operator|++
control|)
block|{
name|int
name|yr
init|=
name|DateUtils
operator|.
name|calculateActualYear
argument_list|(
name|m
argument_list|,
name|acadYear
argument_list|)
decl_stmt|;
if|if
condition|(
name|m
operator|!=
name|startMonth
condition|)
block|{
name|holidayArray
operator|.
name|append
argument_list|(
literal|","
argument_list|)
expr_stmt|;
name|borderArray
operator|.
name|append
argument_list|(
literal|","
argument_list|)
expr_stmt|;
name|colorArray
operator|.
name|append
argument_list|(
literal|","
argument_list|)
expr_stmt|;
block|}
name|holidayArray
operator|.
name|append
argument_list|(
literal|"["
argument_list|)
expr_stmt|;
name|borderArray
operator|.
name|append
argument_list|(
literal|"["
argument_list|)
expr_stmt|;
name|colorArray
operator|.
name|append
argument_list|(
literal|"["
argument_list|)
expr_stmt|;
name|int
name|daysOfMonth
init|=
name|DateUtils
operator|.
name|getNrDaysOfMonth
argument_list|(
name|m
argument_list|,
name|acadYear
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|d
init|=
literal|1
init|;
name|d
operator|<=
name|daysOfMonth
condition|;
name|d
operator|++
control|)
block|{
if|if
condition|(
name|d
operator|>
literal|1
condition|)
block|{
name|holidayArray
operator|.
name|append
argument_list|(
literal|","
argument_list|)
expr_stmt|;
name|borderArray
operator|.
name|append
argument_list|(
literal|","
argument_list|)
expr_stmt|;
name|colorArray
operator|.
name|append
argument_list|(
literal|","
argument_list|)
expr_stmt|;
block|}
name|holidayArray
operator|.
name|append
argument_list|(
literal|"'"
operator|+
name|getHoliday
argument_list|(
name|d
argument_list|,
name|m
argument_list|,
name|acadYear
argument_list|,
name|startMonth
argument_list|,
name|holidays
argument_list|)
operator|+
literal|"'"
argument_list|)
expr_stmt|;
name|String
name|color
init|=
literal|"null"
decl_stmt|;
if|if
condition|(
name|class2eventDateMap
operator|!=
literal|null
condition|)
block|{
if|if
condition|(
name|class2eventDateMap
operator|.
name|hasClassDate
argument_list|(
name|DateUtils
operator|.
name|getDate
argument_list|(
name|d
argument_list|,
name|m
argument_list|,
name|acadYear
argument_list|)
argument_list|)
condition|)
block|{
name|color
operator|=
literal|"'#c0c'"
expr_stmt|;
block|}
if|else if
condition|(
name|class2eventDateMap
operator|.
name|hasEventDate
argument_list|(
name|DateUtils
operator|.
name|getDate
argument_list|(
name|d
argument_list|,
name|m
argument_list|,
name|acadYear
argument_list|)
argument_list|)
condition|)
block|{
name|color
operator|=
literal|"'#0cc'"
expr_stmt|;
block|}
block|}
name|colorArray
operator|.
name|append
argument_list|(
name|color
argument_list|)
expr_stmt|;
if|if
condition|(
name|d
operator|==
name|sessionBeginDate
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|DAY_OF_MONTH
argument_list|)
operator|&&
operator|(
name|m
operator|%
literal|12
operator|)
operator|==
name|sessionBeginDate
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|MONTH
argument_list|)
operator|&&
name|yr
operator|==
name|sessionBeginDate
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|YEAR
argument_list|)
condition|)
name|borderArray
operator|.
name|append
argument_list|(
literal|"'#660000 2px solid'"
argument_list|)
expr_stmt|;
if|else if
condition|(
name|d
operator|==
name|sessionEndDate
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|DAY_OF_MONTH
argument_list|)
operator|&&
operator|(
name|m
operator|%
literal|12
operator|)
operator|==
name|sessionEndDate
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|MONTH
argument_list|)
operator|&&
name|yr
operator|==
name|sessionEndDate
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|YEAR
argument_list|)
condition|)
name|borderArray
operator|.
name|append
argument_list|(
literal|"'#333399 2px solid'"
argument_list|)
expr_stmt|;
if|else if
condition|(
name|d
operator|==
name|classesEndDate
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|DAY_OF_MONTH
argument_list|)
operator|&&
operator|(
name|m
operator|%
literal|12
operator|)
operator|==
name|classesEndDate
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|MONTH
argument_list|)
operator|&&
name|yr
operator|==
name|classesEndDate
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|YEAR
argument_list|)
condition|)
name|borderArray
operator|.
name|append
argument_list|(
literal|"'#339933 2px solid'"
argument_list|)
expr_stmt|;
if|else if
condition|(
name|d
operator|==
name|examBeginDate
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|DAY_OF_MONTH
argument_list|)
operator|&&
operator|(
name|m
operator|%
literal|12
operator|)
operator|==
name|examBeginDate
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|MONTH
argument_list|)
operator|&&
name|yr
operator|==
name|examBeginDate
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|YEAR
argument_list|)
condition|)
name|borderArray
operator|.
name|append
argument_list|(
literal|"'#999933 2px solid'"
argument_list|)
expr_stmt|;
if|else if
condition|(
name|d
operator|==
name|eventBeginDate
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|DAY_OF_MONTH
argument_list|)
operator|&&
operator|(
name|m
operator|%
literal|12
operator|)
operator|==
name|eventBeginDate
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|MONTH
argument_list|)
operator|&&
name|yr
operator|==
name|eventBeginDate
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|YEAR
argument_list|)
condition|)
name|borderArray
operator|.
name|append
argument_list|(
literal|"'yellow 2px solid'"
argument_list|)
expr_stmt|;
if|else if
condition|(
name|d
operator|==
name|eventEndDate
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|DAY_OF_MONTH
argument_list|)
operator|&&
operator|(
name|m
operator|%
literal|12
operator|)
operator|==
name|eventEndDate
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|MONTH
argument_list|)
operator|&&
name|yr
operator|==
name|eventEndDate
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|YEAR
argument_list|)
condition|)
name|borderArray
operator|.
name|append
argument_list|(
literal|"'red 2px solid'"
argument_list|)
expr_stmt|;
else|else
name|borderArray
operator|.
name|append
argument_list|(
literal|"null"
argument_list|)
expr_stmt|;
block|}
name|holidayArray
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
name|borderArray
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
name|colorArray
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
block|}
name|StringBuffer
name|table
init|=
operator|new
name|StringBuffer
argument_list|()
decl_stmt|;
name|table
operator|.
name|append
argument_list|(
literal|"<script language='JavaScript' type='text/javascript' src='scripts/datepatt.js'></script>"
argument_list|)
expr_stmt|;
name|table
operator|.
name|append
argument_list|(
literal|"<script language='JavaScript'>"
argument_list|)
expr_stmt|;
name|table
operator|.
name|append
argument_list|(
literal|"calGenerate2("
operator|+
name|acadYear
operator|+
literal|","
operator|+
name|startMonth
operator|+
literal|","
operator|+
name|endMonth
operator|+
literal|","
operator|+
literal|"["
operator|+
name|holidayArray
operator|+
literal|"],"
operator|+
literal|"["
operator|+
name|prefTable
operator|+
literal|"],"
operator|+
literal|"["
operator|+
name|prefNames
operator|+
literal|"],"
operator|+
literal|"["
operator|+
name|prefColors
operator|+
literal|"],"
operator|+
literal|"'"
operator|+
name|sHolidayTypeNone
operator|+
literal|"',"
operator|+
literal|"["
operator|+
name|borderArray
operator|+
literal|"],["
operator|+
name|colorArray
operator|+
literal|"],"
operator|+
name|editable
operator|+
literal|","
operator|+
name|editable
operator|+
literal|");"
argument_list|)
expr_stmt|;
name|table
operator|.
name|append
argument_list|(
literal|"</script>"
argument_list|)
expr_stmt|;
return|return
name|table
operator|.
name|toString
argument_list|()
return|;
block|}
specifier|public
name|void
name|setHolidays
parameter_list|(
name|String
name|holidays
parameter_list|)
block|{
name|super
operator|.
name|setHolidays
argument_list|(
name|holidays
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|setHolidays
parameter_list|(
name|HttpServletRequest
name|request
parameter_list|)
block|{
name|int
name|startMonth
init|=
name|getStartMonth
argument_list|()
decl_stmt|;
name|int
name|endMonth
init|=
name|getEndMonth
argument_list|()
decl_stmt|;
name|Calendar
name|startCal
init|=
name|Calendar
operator|.
name|getInstance
argument_list|()
decl_stmt|;
name|startCal
operator|.
name|setTime
argument_list|(
name|earliestSessionRelatedDate
argument_list|()
argument_list|)
expr_stmt|;
name|int
name|startYear
init|=
name|getSessionStartYear
argument_list|()
decl_stmt|;
name|StringBuffer
name|sb
init|=
operator|new
name|StringBuffer
argument_list|()
decl_stmt|;
for|for
control|(
name|int
name|m
init|=
name|startMonth
init|;
name|m
operator|<=
name|endMonth
condition|;
name|m
operator|++
control|)
block|{
name|int
name|year
init|=
name|DateUtils
operator|.
name|calculateActualYear
argument_list|(
name|m
argument_list|,
name|startYear
argument_list|)
decl_stmt|;
name|int
name|daysOfMonth
init|=
name|DateUtils
operator|.
name|getNrDaysOfMonth
argument_list|(
name|m
argument_list|,
name|startYear
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|d
init|=
literal|1
init|;
name|d
operator|<=
name|daysOfMonth
condition|;
name|d
operator|++
control|)
block|{
name|String
name|holiday
init|=
name|request
operator|.
name|getParameter
argument_list|(
literal|"cal_val_"
operator|+
name|year
operator|+
literal|"_"
operator|+
operator|(
operator|(
literal|12
operator|+
name|m
operator|)
operator|%
literal|12
operator|)
operator|+
literal|"_"
operator|+
name|d
argument_list|)
decl_stmt|;
name|sb
operator|.
name|append
argument_list|(
name|holiday
operator|==
literal|null
condition|?
name|String
operator|.
name|valueOf
argument_list|(
name|sHolidayTypeNone
argument_list|)
else|:
name|holiday
argument_list|)
expr_stmt|;
block|}
block|}
name|setHolidays
argument_list|(
name|sb
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|public
name|int
name|compareTo
parameter_list|(
name|Session
name|s
parameter_list|)
block|{
if|if
condition|(
name|s
operator|==
literal|null
condition|)
return|return
operator|-
literal|1
return|;
name|int
name|cmp
init|=
name|getAcademicInitiative
argument_list|()
operator|.
name|compareTo
argument_list|(
name|s
operator|.
name|getAcademicInitiative
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
name|cmp
operator|!=
literal|0
condition|)
return|return
name|cmp
return|;
name|cmp
operator|=
name|getSessionBeginDateTime
argument_list|()
operator|.
name|compareTo
argument_list|(
name|s
operator|.
name|getSessionBeginDateTime
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|cmp
operator|!=
literal|0
condition|)
return|return
name|cmp
return|;
return|return
operator|(
name|getUniqueId
argument_list|()
operator|==
literal|null
condition|?
name|Long
operator|.
name|valueOf
argument_list|(
operator|-
literal|1
argument_list|)
else|:
name|getUniqueId
argument_list|()
operator|)
operator|.
name|compareTo
argument_list|(
name|s
operator|.
name|getUniqueId
argument_list|()
operator|==
literal|null
condition|?
operator|-
literal|1
else|:
name|s
operator|.
name|getUniqueId
argument_list|()
argument_list|)
return|;
block|}
specifier|public
name|DatePattern
name|getDefaultDatePatternNotNull
parameter_list|()
block|{
name|DatePattern
name|dp
init|=
name|super
operator|.
name|getDefaultDatePattern
argument_list|()
decl_stmt|;
if|if
condition|(
name|dp
operator|==
literal|null
condition|)
block|{
name|dp
operator|=
name|DatePattern
operator|.
name|findByName
argument_list|(
name|this
argument_list|,
literal|"Full Term"
argument_list|)
expr_stmt|;
block|}
return|return
name|dp
return|;
block|}
specifier|public
name|int
name|getNrWeeks
parameter_list|()
block|{
name|Calendar
name|sessionBeginDate
init|=
name|Calendar
operator|.
name|getInstance
argument_list|(
name|Locale
operator|.
name|US
argument_list|)
decl_stmt|;
name|sessionBeginDate
operator|.
name|setTime
argument_list|(
name|getSessionBeginDateTime
argument_list|()
argument_list|)
expr_stmt|;
name|Calendar
name|sessionEndDate
init|=
name|Calendar
operator|.
name|getInstance
argument_list|(
name|Locale
operator|.
name|US
argument_list|)
decl_stmt|;
name|sessionEndDate
operator|.
name|setTime
argument_list|(
name|getSessionEndDateTime
argument_list|()
argument_list|)
expr_stmt|;
name|int
name|beginDay
init|=
name|getDayOfYear
argument_list|(
name|sessionBeginDate
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|DAY_OF_MONTH
argument_list|)
argument_list|,
name|sessionBeginDate
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|MONTH
argument_list|)
argument_list|)
operator|-
name|getDayOfYear
argument_list|(
literal|1
argument_list|,
name|getStartMonth
argument_list|()
argument_list|)
decl_stmt|;
name|int
name|endDay
init|=
name|getDayOfYear
argument_list|(
name|sessionEndDate
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|DAY_OF_MONTH
argument_list|)
argument_list|,
name|sessionEndDate
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|MONTH
argument_list|)
argument_list|)
operator|-
name|getDayOfYear
argument_list|(
literal|1
argument_list|,
name|getStartMonth
argument_list|()
argument_list|)
decl_stmt|;
name|int
name|nrDays
init|=
literal|0
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
name|beginDay
init|;
name|i
operator|<=
name|endDay
condition|;
name|i
operator|++
control|)
block|{
if|if
condition|(
name|getHolidays
argument_list|()
operator|==
literal|null
operator|||
name|i
operator|>=
name|getHolidays
argument_list|()
operator|.
name|length
argument_list|()
operator|||
operator|(
name|getHolidays
argument_list|()
operator|.
name|charAt
argument_list|(
name|i
argument_list|)
operator|-
literal|'0'
operator|)
operator|==
name|sHolidayTypeNone
condition|)
name|nrDays
operator|++
expr_stmt|;
block|}
name|nrDays
operator|-=
literal|7
expr_stmt|;
return|return
operator|(
literal|6
operator|+
name|nrDays
operator|)
operator|/
literal|7
return|;
block|}
specifier|public
name|int
name|getExamBeginOffset
parameter_list|()
block|{
return|return
operator|(
name|int
operator|)
name|Math
operator|.
name|round
argument_list|(
operator|(
name|getSessionBeginDateTime
argument_list|()
operator|.
name|getTime
argument_list|()
operator|-
name|getExamBeginDate
argument_list|()
operator|.
name|getTime
argument_list|()
operator|)
operator|/
literal|86.4e6
argument_list|)
return|;
block|}
specifier|public
name|String
name|getBorder
parameter_list|(
name|int
name|day
parameter_list|,
name|int
name|month
parameter_list|)
block|{
name|Calendar
name|cal
init|=
name|Calendar
operator|.
name|getInstance
argument_list|(
name|Locale
operator|.
name|US
argument_list|)
decl_stmt|;
name|cal
operator|.
name|setTime
argument_list|(
name|getSessionBeginDateTime
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|day
operator|==
name|cal
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|DAY_OF_MONTH
argument_list|)
operator|&&
operator|(
operator|(
literal|12
operator|+
name|month
operator|)
operator|%
literal|12
operator|)
operator|==
name|cal
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|MONTH
argument_list|)
condition|)
return|return
literal|"'blue 2px solid'"
return|;
name|cal
operator|.
name|setTime
argument_list|(
name|getClassesEndDateTime
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|day
operator|==
name|cal
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|DAY_OF_MONTH
argument_list|)
operator|&&
operator|(
operator|(
literal|12
operator|+
name|month
operator|)
operator|%
literal|12
operator|)
operator|==
name|cal
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|MONTH
argument_list|)
condition|)
return|return
literal|"'blue 2px solid'"
return|;
if|if
condition|(
name|getExamBeginDate
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|cal
operator|.
name|setTime
argument_list|(
name|getExamBeginDate
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|day
operator|==
name|cal
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|DAY_OF_MONTH
argument_list|)
operator|&&
operator|(
operator|(
literal|12
operator|+
name|month
operator|)
operator|%
literal|12
operator|)
operator|==
name|cal
operator|.
name|get
argument_list|(
name|Calendar
operator|.
name|MONTH
argument_list|)
condition|)
return|return
literal|"'green 2px solid'"
return|;
block|}
name|int
name|holiday
init|=
name|getHoliday
argument_list|(
name|day
argument_list|,
name|month
argument_list|)
decl_stmt|;
if|if
condition|(
name|holiday
operator|!=
name|Session
operator|.
name|sHolidayTypeNone
condition|)
return|return
literal|"'"
operator|+
name|Session
operator|.
name|sHolidayTypeColors
index|[
name|holiday
index|]
operator|+
literal|" 2px solid'"
return|;
return|return
literal|"null"
return|;
block|}
specifier|public
name|String
name|getColorArray
parameter_list|()
block|{
name|EventDateMapping
operator|.
name|Class2EventDateMap
name|class2EventDateMap
init|=
name|EventDateMapping
operator|.
name|getMapping
argument_list|(
name|getUniqueId
argument_list|()
argument_list|)
decl_stmt|;
name|int
name|startMonth
init|=
name|getSession
argument_list|()
operator|.
name|getPatternStartMonth
argument_list|()
decl_stmt|;
name|int
name|endMonth
init|=
name|getSession
argument_list|()
operator|.
name|getPatternEndMonth
argument_list|()
decl_stmt|;
name|int
name|year
init|=
name|getSession
argument_list|()
operator|.
name|getSessionStartYear
argument_list|()
decl_stmt|;
name|StringBuffer
name|sb
init|=
operator|new
name|StringBuffer
argument_list|(
literal|"["
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|m
init|=
name|startMonth
init|;
name|m
operator|<=
name|endMonth
condition|;
name|m
operator|++
control|)
block|{
if|if
condition|(
name|m
operator|!=
name|startMonth
condition|)
name|sb
operator|.
name|append
argument_list|(
literal|","
argument_list|)
expr_stmt|;
name|sb
operator|.
name|append
argument_list|(
literal|"["
argument_list|)
expr_stmt|;
name|int
name|daysOfMonth
init|=
name|DateUtils
operator|.
name|getNrDaysOfMonth
argument_list|(
name|m
argument_list|,
name|year
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|d
init|=
literal|1
init|;
name|d
operator|<=
name|daysOfMonth
condition|;
name|d
operator|++
control|)
block|{
if|if
condition|(
name|d
operator|>
literal|1
condition|)
name|sb
operator|.
name|append
argument_list|(
literal|","
argument_list|)
expr_stmt|;
name|String
name|color
init|=
literal|"null"
decl_stmt|;
if|if
condition|(
name|class2EventDateMap
operator|!=
literal|null
condition|)
block|{
if|if
condition|(
name|class2EventDateMap
operator|.
name|hasClassDate
argument_list|(
name|DateUtils
operator|.
name|getDate
argument_list|(
name|d
argument_list|,
name|m
argument_list|,
name|year
argument_list|)
argument_list|)
condition|)
block|{
name|color
operator|=
literal|"'#c0c'"
expr_stmt|;
block|}
if|else if
condition|(
name|class2EventDateMap
operator|.
name|hasEventDate
argument_list|(
name|DateUtils
operator|.
name|getDate
argument_list|(
name|d
argument_list|,
name|m
argument_list|,
name|year
argument_list|)
argument_list|)
condition|)
block|{
name|color
operator|=
literal|"'#0cc'"
expr_stmt|;
block|}
block|}
name|sb
operator|.
name|append
argument_list|(
name|color
argument_list|)
expr_stmt|;
block|}
name|sb
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
block|}
name|sb
operator|.
name|append
argument_list|(
literal|"]"
argument_list|)
expr_stmt|;
return|return
name|sb
operator|.
name|toString
argument_list|()
return|;
block|}
comment|/** Return distance of the given date outside the session start/end date (in milliseconds) */
specifier|public
name|long
name|getDistance
parameter_list|(
name|Date
name|date
parameter_list|)
block|{
if|if
condition|(
name|date
operator|.
name|compareTo
argument_list|(
name|getEventBeginDate
argument_list|()
argument_list|)
operator|<
literal|0
condition|)
comment|//before session
return|return
name|getEventBeginDate
argument_list|()
operator|.
name|getTime
argument_list|()
operator|-
name|date
operator|.
name|getTime
argument_list|()
return|;
if|if
condition|(
name|date
operator|.
name|compareTo
argument_list|(
name|getEventEndDate
argument_list|()
argument_list|)
operator|>
literal|0
condition|)
comment|//after session
return|return
name|date
operator|.
name|getTime
argument_list|()
operator|-
name|getEventEndDate
argument_list|()
operator|.
name|getTime
argument_list|()
return|;
return|return
literal|0
return|;
comment|//inside session
block|}
specifier|public
name|boolean
name|hasStudentSchedule
parameter_list|()
block|{
return|return
name|hasStudentSchedule
argument_list|(
name|getUniqueId
argument_list|()
argument_list|)
return|;
block|}
specifier|public
specifier|static
name|boolean
name|hasStudentSchedule
parameter_list|(
name|Long
name|sessionId
parameter_list|)
block|{
return|return
operator|(
operator|(
name|Number
operator|)
operator|new
name|ExamDAO
argument_list|()
operator|.
name|getSession
argument_list|()
operator|.
name|createQuery
argument_list|(
literal|"select count(x) from StudentClassEnrollment x "
operator|+
literal|"where x.student.session.uniqueId=:sessionId"
argument_list|)
operator|.
name|setLong
argument_list|(
literal|"sessionId"
argument_list|,
name|sessionId
argument_list|)
operator|.
name|uniqueResult
argument_list|()
operator|)
operator|.
name|longValue
argument_list|()
operator|>
literal|0
return|;
block|}
specifier|private
name|OnlineSectioningServer
name|getInstance
parameter_list|()
block|{
if|if
condition|(
name|getUniqueId
argument_list|()
operator|==
literal|null
condition|)
return|return
literal|null
return|;
return|return
operator|(
operator|(
name|SolverServerService
operator|)
name|SpringApplicationContextHolder
operator|.
name|getBean
argument_list|(
literal|"solverServerService"
argument_list|)
operator|)
operator|.
name|getOnlineStudentSchedulingContainer
argument_list|()
operator|.
name|getSolver
argument_list|(
name|getUniqueId
argument_list|()
operator|.
name|toString
argument_list|()
argument_list|)
return|;
block|}
specifier|public
name|Collection
argument_list|<
name|Long
argument_list|>
name|getLockedOfferings
parameter_list|()
block|{
if|if
condition|(
operator|!
name|getStatusType
argument_list|()
operator|.
name|canLockOfferings
argument_list|()
condition|)
return|return
literal|null
return|;
name|OnlineSectioningServer
name|server
init|=
name|getInstance
argument_list|()
decl_stmt|;
return|return
operator|(
name|server
operator|==
literal|null
operator|||
operator|!
name|server
operator|.
name|isReady
argument_list|()
condition|?
literal|null
else|:
name|server
operator|.
name|getLockedOfferings
argument_list|()
operator|)
return|;
block|}
specifier|public
name|boolean
name|isOfferingLocked
parameter_list|(
name|Long
name|offeringId
parameter_list|)
block|{
if|if
condition|(
operator|!
name|getStatusType
argument_list|()
operator|.
name|canLockOfferings
argument_list|()
condition|)
return|return
literal|false
return|;
name|OnlineSectioningServer
name|server
init|=
name|getInstance
argument_list|()
decl_stmt|;
return|return
name|server
operator|!=
literal|null
operator|&&
name|server
operator|.
name|isOfferingLocked
argument_list|(
name|offeringId
argument_list|)
return|;
block|}
specifier|public
name|void
name|lockOffering
parameter_list|(
name|Long
name|offeringId
parameter_list|)
block|{
if|if
condition|(
name|getStatusType
argument_list|()
operator|.
name|canLockOfferings
argument_list|()
condition|)
block|{
name|OnlineSectioningServer
name|server
init|=
name|getInstance
argument_list|()
decl_stmt|;
if|if
condition|(
name|server
operator|!=
literal|null
condition|)
name|server
operator|.
name|lockOffering
argument_list|(
name|offeringId
argument_list|)
expr_stmt|;
block|}
block|}
specifier|public
name|void
name|unlockOffering
parameter_list|(
name|InstructionalOffering
name|offering
parameter_list|,
name|UserContext
name|user
parameter_list|)
block|{
name|OnlineSectioningServer
name|server
init|=
name|getInstance
argument_list|()
decl_stmt|;
if|if
condition|(
name|server
operator|!=
literal|null
condition|)
block|{
name|server
operator|.
name|execute
argument_list|(
name|server
operator|.
name|createAction
argument_list|(
name|ReloadOfferingAction
operator|.
name|class
argument_list|)
operator|.
name|forOfferings
argument_list|(
name|offering
operator|.
name|getUniqueId
argument_list|()
argument_list|)
argument_list|,
operator|(
name|user
operator|==
literal|null
condition|?
literal|null
else|:
name|OnlineSectioningLog
operator|.
name|Entity
operator|.
name|newBuilder
argument_list|()
operator|.
name|setExternalId
argument_list|(
name|user
operator|.
name|getExternalUserId
argument_list|()
argument_list|)
operator|.
name|setName
argument_list|(
name|user
operator|.
name|getName
argument_list|()
argument_list|)
operator|.
name|setType
argument_list|(
name|OnlineSectioningLog
operator|.
name|Entity
operator|.
name|EntityType
operator|.
name|MANAGER
argument_list|)
operator|.
name|build
argument_list|()
operator|)
argument_list|)
expr_stmt|;
name|server
operator|.
name|unlockOffering
argument_list|(
name|offering
operator|.
name|getUniqueId
argument_list|()
argument_list|)
expr_stmt|;
block|}
try|try
block|{
name|SessionFactory
name|hibSessionFactory
init|=
name|SessionDAO
operator|.
name|getInstance
argument_list|()
operator|.
name|getSession
argument_list|()
operator|.
name|getSessionFactory
argument_list|()
decl_stmt|;
name|hibSessionFactory
operator|.
name|getCache
argument_list|()
operator|.
name|evictEntity
argument_list|(
name|InstructionalOffering
operator|.
name|class
argument_list|,
name|offering
operator|.
name|getUniqueId
argument_list|()
argument_list|)
expr_stmt|;
for|for
control|(
name|CourseOffering
name|course
range|:
name|offering
operator|.
name|getCourseOfferings
argument_list|()
control|)
name|hibSessionFactory
operator|.
name|getCache
argument_list|()
operator|.
name|evictEntity
argument_list|(
name|CourseOffering
operator|.
name|class
argument_list|,
name|course
operator|.
name|getUniqueId
argument_list|()
argument_list|)
expr_stmt|;
for|for
control|(
name|InstrOfferingConfig
name|config
range|:
name|offering
operator|.
name|getInstrOfferingConfigs
argument_list|()
control|)
for|for
control|(
name|SchedulingSubpart
name|subpart
range|:
name|config
operator|.
name|getSchedulingSubparts
argument_list|()
control|)
for|for
control|(
name|Class_
name|clazz
range|:
name|subpart
operator|.
name|getClasses
argument_list|()
control|)
name|hibSessionFactory
operator|.
name|getCache
argument_list|()
operator|.
name|evictEntity
argument_list|(
name|Class_
operator|.
name|class
argument_list|,
name|clazz
operator|.
name|getUniqueId
argument_list|()
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
name|Debug
operator|.
name|error
argument_list|(
literal|"Failed to evict cache: "
operator|+
name|e
operator|.
name|getMessage
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
annotation|@
name|Override
specifier|public
name|Session
name|getSession
parameter_list|()
block|{
return|return
name|this
return|;
block|}
annotation|@
name|Override
specifier|public
name|Serializable
name|getQualifierId
parameter_list|()
block|{
return|return
name|getUniqueId
argument_list|()
return|;
block|}
annotation|@
name|Override
specifier|public
name|String
name|getQualifierType
parameter_list|()
block|{
return|return
name|getClass
argument_list|()
operator|.
name|getSimpleName
argument_list|()
return|;
block|}
annotation|@
name|Override
specifier|public
name|String
name|getQualifierReference
parameter_list|()
block|{
return|return
name|getReference
argument_list|()
return|;
block|}
annotation|@
name|Override
specifier|public
name|String
name|getQualifierLabel
parameter_list|()
block|{
return|return
name|getLabel
argument_list|()
return|;
block|}
annotation|@
name|Override
specifier|public
name|Department
name|getDepartment
parameter_list|()
block|{
return|return
literal|null
return|;
block|}
specifier|public
name|boolean
name|canNoRoleReportExamFinal
parameter_list|()
block|{
return|return
operator|(
operator|(
name|Number
operator|)
operator|new
name|ExamDAO
argument_list|()
operator|.
name|getSession
argument_list|()
operator|.
name|createQuery
argument_list|(
literal|"select count(e) from FinalExamEvent e inner join e.exam.session s where s.uniqueId = :sessionId and "
operator|+
literal|"((e.examStatus is null and bit_and(s.statusType.status, :flag)> 0) or bit_and(e.examStatus, :flag)> 0)"
argument_list|)
operator|.
name|setLong
argument_list|(
literal|"sessionId"
argument_list|,
name|getUniqueId
argument_list|()
argument_list|)
operator|.
name|setInteger
argument_list|(
literal|"flag"
argument_list|,
name|DepartmentStatusType
operator|.
name|Status
operator|.
name|ReportExamsFinal
operator|.
name|toInt
argument_list|()
argument_list|)
operator|.
name|setCacheable
argument_list|(
literal|true
argument_list|)
operator|.
name|uniqueResult
argument_list|()
operator|)
operator|.
name|longValue
argument_list|()
operator|>
literal|0
return|;
block|}
specifier|public
name|boolean
name|canNoRoleReportExamMidterm
parameter_list|()
block|{
return|return
operator|(
operator|(
name|Number
operator|)
operator|new
name|ExamDAO
argument_list|()
operator|.
name|getSession
argument_list|()
operator|.
name|createQuery
argument_list|(
literal|"select count(e) from MidtermExamEvent e inner join e.exam.session s where s.uniqueId = :sessionId and "
operator|+
literal|"((e.examStatus is null and bit_and(s.statusType.status, :flag)> 0) or bit_and(e.examStatus, :flag)> 0)"
argument_list|)
operator|.
name|setLong
argument_list|(
literal|"sessionId"
argument_list|,
name|getUniqueId
argument_list|()
argument_list|)
operator|.
name|setInteger
argument_list|(
literal|"flag"
argument_list|,
name|DepartmentStatusType
operator|.
name|Status
operator|.
name|ReportExamsMidterm
operator|.
name|toInt
argument_list|()
argument_list|)
operator|.
name|setCacheable
argument_list|(
literal|true
argument_list|)
operator|.
name|uniqueResult
argument_list|()
operator|)
operator|.
name|longValue
argument_list|()
operator|>
literal|0
return|;
block|}
specifier|public
name|boolean
name|canNoRoleReportClass
parameter_list|()
block|{
return|return
name|getStatusType
argument_list|()
operator|!=
literal|null
operator|&&
name|getStatusType
argument_list|()
operator|.
name|can
argument_list|(
name|DepartmentStatusType
operator|.
name|Status
operator|.
name|ReportClasses
argument_list|)
operator|&&
name|Solution
operator|.
name|hasTimetable
argument_list|(
name|getUniqueId
argument_list|()
argument_list|)
return|;
block|}
specifier|public
name|boolean
name|canNoRoleReportExam
parameter_list|()
block|{
return|return
name|canNoRoleReportExamFinal
argument_list|()
operator|||
name|canNoRoleReportExamMidterm
argument_list|()
return|;
block|}
specifier|public
name|boolean
name|canNoRoleReport
parameter_list|()
block|{
return|return
name|canNoRoleReportClass
argument_list|()
operator|||
name|canNoRoleReportExam
argument_list|()
return|;
block|}
specifier|public
name|Date
name|getCurrentSnapshotDate
parameter_list|()
block|{
name|Object
name|o
init|=
name|InstructionalOfferingDAO
operator|.
name|getInstance
argument_list|()
operator|.
name|getSession
argument_list|()
operator|.
name|createQuery
argument_list|(
literal|"select max(io.snapshotLimitDate) from InstructionalOffering io where io.session.uniqueId = :sessId"
argument_list|)
operator|.
name|setLong
argument_list|(
literal|"sessId"
argument_list|,
name|getUniqueId
argument_list|()
operator|.
name|longValue
argument_list|()
argument_list|)
operator|.
name|uniqueResult
argument_list|()
decl_stmt|;
name|Date
name|snapshotDate
init|=
literal|null
decl_stmt|;
if|if
condition|(
name|o
operator|!=
literal|null
condition|)
block|{
name|snapshotDate
operator|=
operator|(
name|Date
operator|)
name|o
expr_stmt|;
block|}
return|return
operator|(
name|snapshotDate
operator|)
return|;
block|}
block|}
end_class

end_unit

